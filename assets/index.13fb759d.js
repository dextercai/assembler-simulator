var hn=Object.defineProperty,pn=Object.defineProperties;var gn=Object.getOwnPropertyDescriptors;var Lt=Object.getOwnPropertySymbols;var fn=Object.prototype.hasOwnProperty,mn=Object.prototype.propertyIsEnumerable;var He=(e,t,s)=>t in e?hn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,A=(e,t)=>{for(var s in t||(t={}))fn.call(t,s)&&He(e,s,t[s]);if(Lt)for(var s of Lt(t))mn.call(t,s)&&He(e,s,t[s]);return e},M=(e,t)=>pn(e,gn(t));var k=(e,t,s)=>(He(e,typeof t!="symbol"?t+"":t,s),s);import{c as de,a as Z,b as ns,g as Rn,d as bn,e as vn,r as R,j as n,f as d,F as G,u as En,h as Sn,i as _n,E as xn,k as $,S as Te,D as be,l as at,m as wn,n as yn,G as Nn,R as In,o as Cn,A as Ln,p as Dn,L as An,s as kn,q as Mn,t as Tn,v as On,w as Gn,x as Bn,y as Pn,z as Un,B as Fn,C as Hn,H as Vn,I as Wn,J as Jn,K as zn,M as $n,N as jn,O as Kn,P as Xn,Q as Zn,T as Yn}from"./vendor.629f42b9.js";const qn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}};qn();const rs=e=>e.sliceString(0),We=(e,t)=>{const{from:s,to:r,number:a}=e.lineAt(t);return{from:s,to:r,number:a}},as=(e,t)=>e.from===t.from&&e.to===t.to,Qn=(e,t)=>e.from<t.to&&t.from<e.to;var Dt=`; --------------------------------------
;	Untitled
; --------------------------------------
	
; --------------------------------------
	END
; --------------------------------------
`,er=`; --------------------------------------
;	Procedures
; --------------------------------------
	MOV  AL, E0		; 1110 0000
Loop:
	NOT  AL			; Invert the bits in AL
	OUT  01			; Send data to traffic lights
	MOV  BL, 01		; Short delay
	CALL 30			; Call procedure 30

	NOT  AL			; Invert the bits in AL
	OUT  01			; Send data to traffic lights
	MOV  BL, 04		; Middle sized delay
	CALL 30			; Call procedure 30

	NOT  AL			; Invert the bits in AL
	OUT  01			; Send data to traffic lights
	MOV  BL, 08		; Longer delay
	CALL 30			; Call procedure 30
	JMP  Loop
; --------------------------------------
	ORG  30
Rep:
	DEC  BL			; Subtract one from BL
	JNZ  Rep
	RET
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`,tr=`; --------------------------------------
;	Software Interrupts
; --------------------------------------
	JMP Start		; Jump past the table of interrupt vectors
	DB   51			; Vector at 02 pointing to address 51
	DB   71			; Vector at 03 pointing to address 71
Start:
	INT  02			; Do interrupt 02
	INT  03			; Do interrupt 03
	JMP Start
; --------------------------------------
	ORG  50
	DB   E0
					; Interrupt code starts here
	MOV  AL, [50]	; Copy bits from RAM into AL
	NOT  AL			; Invert the bits in AL
	MOV [50], AL	; Copy inverted bits back to RAM
	OUT  01			; Send data to traffic lights
	IRET
; --------------------------------------
	ORG  70
	DB   FE
					; Interrupt code starts here
	MOV  AL, [70]	; Copy bits from RAM into AL
	NOT  AL			; Invert the bits in AL
	AND  AL,  FE	; Set the right most bit to zero
	MOV [70], AL	; Copy inverted bits back to RAM
	OUT  02			; Send data to seven-segment display
	IRET
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`,sr=`; --------------------------------------
;	Hardware Interrupts
; --------------------------------------
	JMP	 Start		; Jump past the table of interrupt vectors
	DB   50			; Vector at 02 pointing to address 50
Start:
	STI				; Set I flag. Enable hardware interrupts
	MOV	 AL,  30	; ASCII for '0'
Loop:
	MOV [C0], AL	; Copy the data in AL to the video RAM
	INC	 AL			; Add one to AL
	JMP	Loop
; --------------------------------------
	ORG	 50
	MOV  AL,  30	; Reset AL to ASCII for '0'
	IRET
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`,nr=`; --------------------------------------
;	Keyboard Input
; --------------------------------------
	MOV  BL, C0		; Make BL point to video RAM
Loop:
	IN   00			; Wait for keyboard input
	CMP  AL, 0D		; Check if the key was Enter (Carriage Return)
	JZ  Done
	MOV [BL], AL	; Copy the data in AL to the video RAM that BL points to
	INC  BL			; Make BL point to the next video RAM location
	JNZ Loop
Done:
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`,rr=`; --------------------------------------
;	Visual Display Unit
; --------------------------------------
	JMP Start		; Jump past the data table
	DB  "Hello World!"
	DB   00
Start:
	MOV  AL,  C0	; Make AL point to video RAM
	MOV  BL,  02	; Make BL point to the first character in the string
	MOV  CL, [BL]	; Copy the data from RAM into CL
Loop:
	MOV [AL], CL	; Copy the data in CL to the video RAM that AL points to
	INC  AL			; Make AL point to the next video RAM location
	INC  BL			; Make BL point to the next character in the string
	MOV  CL, [BL]	; Copy the data from RAM into CL
	CMP  CL,  00	; Check if the next character exists
	JNZ Loop
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`,ar=`; --------------------------------------
;	Traffic Lights
; --------------------------------------
	MOV AL, 80		; 1000 0000
Loop:
	OUT 01			; Send data to traffic lights
	ROR AL			; Rotate the bits in AL to the right
	JMP Loop
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`,or=`; --------------------------------------
;	Seven-segment Display
; --------------------------------------
	JMP Start		; Jump past the data table
	DB  FA			; 0 - 1111 1010
	DB  60			; 1 - 0110 0000
	DB  B6			; 2 - 1011 0110
	DB  9E			; 3 - 1001 1110
	DB  4E			; 4 - 0100 1110
	DB  DC			; 5 - 1101 1100
	DB  FC			; 6 - 1111 1100
	DB  8A			; 7 - 1000 1010
	DB  FE			; 8 - 1111 1110
	DB  DE			; 9 - 1101 1110
	DB  00
Start:
	MOV BL,  02		; Make BL point to the first entry in the data table
	MOV AL, [BL]	; Copy data from table to AL
Loop:
	OUT 02			; Send data to seven-segment display
	INC AL			; Set the right most bit to one
	NOP NOP NOP		; Wait for three cycles
	OUT 02			; Send data to seven-segment display
	INC BL			; Make BL point to the next entry in the data table
	MOV AL, [BL]	; Copy data from table to AL
	CMP AL,  00		; Check if the next entry exists
	JNZ Loop
	JMP Start
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`;const ir=/;\t(.*)/,os=e=>ir.exec(e)[1],Je={title:os(Dt),content:Dt},is=[er,tr,sr,nr,rr,ar,or].map(e=>({title:os(e),content:e})),cr=e=>Object.prototype.toString.call(e).slice(8,-1),At=e=>cr(e)==="Object",cs=(e,t)=>{const s={},r=Object.getOwnPropertyNames(t),a=Object.getOwnPropertySymbols(t),o=At(e);if(o){const h=Object.getOwnPropertyNames(e),f=Object.getOwnPropertySymbols(e),u=E=>{const L=typeof E=="symbol";(!L&&!r.includes(E)||L&&!a.includes(E))&&(s[E]=e[E])};h.forEach(u),f.forEach(u)}const c=h=>{const f=t[h],u=o&&At(f);s[h]=u?cs(e[h],f):f};return r.forEach(c),a.forEach(c),s},ls=(e,...t)=>t.reduce((s,r)=>cs(s,r),e),P=(...e)=>{let t="";for(let s=0;s<e.length;s++){const r=e[s];if(r!=null)if(typeof r=="string")t.length>0&&(t+=" "),t+=r;else for(const a in r)r[a]===!0&&(t.length>0&&(t+=" "),t+=a)}return t},ee=e=>e>=128?e-255-1:e,ds=e=>e<0?e+255+1:e,us=e=>e.toString(2).padStart(8,"0"),te=e=>e.toString(16).padStart(2,"0").toUpperCase(),lr=e=>us(e).split("").map(Number),dr=(e,t,s)=>Math.min(Math.max(e,t),s),hs=e=>Number.parseInt(e,16),ce=(e,t)=>(t===void 0&&(t=e,e=0),Array.from({length:t-e},(s,r)=>e+r)),ur=e=>e.split(/(?=[A-Z])/).join(" "),hr=/^\[(.*)\]$/,ot=e=>e.replace(hr,"$1"),pr=/\\/g,gr=e=>e.replace(pr,"\\\\"),fr=/'/g,mr=e=>e.replace(fr,"\\'"),Rr=/'.*'/,br=e=>{var s;const t=(s=Rr.exec(e))==null?void 0:s[0];return t===void 0?e:e.replace(t,`'${mr(t.slice(1,-1))}'`)},vr=e=>e.split("").map(t=>t.charCodeAt(0)),Er=(e,t)=>e.every((s,r)=>s===t[r]),it=(e,t)=>{const s=[];for(let r=0;r<t.length;r+=e)s.push(t.slice(r,r+e));return s},Sr=e=>e.map(t=>String.fromCharCode(t)),ps=()=>{},ct=e=>e(),_r=e=>t=>s=>e(s,t),xr=(e,t)=>{let s,r;return function a(...o){const c=Date.now();r!==void 0&&(window.clearTimeout(r),r=void 0),s===void 0||c-s>=t?(e(...o),s=c):r=window.setTimeout(()=>{a(...o),r=void 0},t-(c-s))}},Oe=({name:e,message:t,stack:s})=>({name:e,message:t,stack:s});var ie=(e=>(e[e.Info=0]="Info",e[e.Warning=1]="Warning",e[e.Error=2]="Error",e))(ie||{});const wr={input:is[4].content,breakpoints:[],activeRange:null,message:null},lt=de({name:"editor",initialState:wr,reducers:{setInput:{reducer:(e,t)=>{e.input=t.payload.value},prepare:({value:e,isFromFile:t=!1})=>({payload:{value:e,isFromFile:t}})},setBreakpoints:(e,t)=>{e.breakpoints=t.payload},addBreakpoint:(e,t)=>{const s=t.payload,r=e.breakpoints.findIndex(a=>a.from>s.from);r===-1?e.breakpoints.push(s):e.breakpoints.splice(r,0,s)},removeBreakpoint:(e,t)=>{const s=t.payload,r=e.breakpoints.findIndex(a=>as(a,s));e.breakpoints.splice(r,1)},setActiveRange:(e,t)=>{const s=t.payload;e.activeRange=s.range},clearActiveRange:e=>{e.activeRange=null},setMessage:(e,t)=>{e.message=t.payload},clearMessage:e=>{e.message=null}}}),_e=e=>e.editor.input,dt=e=>e.editor.breakpoints,yr=e=>e.editor.activeRange,Nr=_r(Z([yr,(e,t)=>t],(e,t)=>{if(e===null||t===void 0)return;const s=[];return ce(e.from,e.to+1).forEach(r=>{if(r<=t.state.doc.length){const a=t.state.doc.lineAt(r);s.includes(a.from)||s.push(a.from)}}),s.length>0?s:void 0})),kt=e=>e.editor.message,Ir=Z(_e,dt,(e,t)=>({input:e,breakpoints:t})),{setInput:Y,setBreakpoints:gs,addBreakpoint:Cr,removeBreakpoint:Lr,setActiveRange:fs,clearActiveRange:ve,setMessage:ze,clearMessage:Mt}=lt.actions;var Dr=lt.reducer;const Tt={source:"",addressToStatementMap:{},error:null},ms=de({name:"assembler",initialState:Tt,reducers:{setState:(e,t)=>{e.source=t.payload.source,e.addressToStatementMap=t.payload.addressToStatementMap,e.error=null},setError:(e,t)=>{e.source="",e.addressToStatementMap={},e.error=t.payload},clearError:e=>{e.error=null},resetState:()=>Tt}}),Ar=e=>e.assembler.source,Rs=e=>e.assembler.addressToStatementMap,bs=e=>e.assembler.error,kr=e=>{var t;return(t=e.assembler.error)==null?void 0:t.range},{setState:vs,setError:Mr,clearError:Tr,resetState:Or}=ms.actions;var Gr=ms.reducer,$e=(e=>(e[e["2 Hz"]=2]="2 Hz",e[e["4 Hz"]=4]="4 Hz",e[e["8 Hz"]=8]="8 Hz",e[e["16 Hz"]=16]="16 Hz",e[e["32 Hz"]=32]="32 Hz",e[e["64 Hz"]=64]="64 Hz",e))($e||{});const Br=["2 Hz","4 Hz","8 Hz","16 Hz","32 Hz","64 Hz"];var je=(e=>(e[e["1 second"]=1e3]="1 second",e[e["2 seconds"]=2e3]="2 seconds",e[e["4 seconds"]=4e3]="4 seconds",e[e["8 seconds"]=8e3]="8 seconds",e))(je||{});const Pr=["1 second","2 seconds","4 seconds","8 seconds"],Ur={configuration:{autoAssemble:!0,clockSpeed:4,timerInterval:2e3},isRunning:!1,isSuspended:!1},ut=de({name:"controller",initialState:Ur,reducers:{setAutoAssemble:(e,t)=>{e.configuration.autoAssemble=t.payload},setClockSpeed:(e,t)=>{e.configuration.clockSpeed=t.payload},setTimerInterval:(e,t)=>{e.configuration.timerInterval=t.payload},setRunning:(e,t)=>{e.isRunning=t.payload},setSuspended:(e,t)=>{e.isSuspended=t.payload}}}),Fr=e=>e.controller.configuration,Ke=e=>e.controller.configuration.autoAssemble,Es=e=>e.controller.configuration.clockSpeed,Ss=e=>e.controller.configuration.timerInterval,Xe=Z(Es,Ss,(e,t)=>({clockSpeed:e,timerInterval:t})),Ee=e=>e.controller.isRunning,he=e=>e.controller.isSuspended,Hr=Z(Fr,e=>({configuration:e})),{setAutoAssemble:_s,setClockSpeed:Vr,setTimerInterval:Wr,setRunning:Ot,setSuspended:Ie}=ut.actions;var Jr=ut.reducer;const ue="\xA0",ht=250;var me=(e=>(e[e.BS=8]="BS",e[e.TAB=9]="TAB",e[e.CR=13]="CR",e[e.Space=32]="Space",e))(me||{}),x=(e=>(e.END="END",e.ADD="ADD",e.SUB="SUB",e.MUL="MUL",e.DIV="DIV",e.INC="INC",e.DEC="DEC",e.MOD="MOD",e.AND="AND",e.OR="OR",e.XOR="XOR",e.NOT="NOT",e.ROL="ROL",e.ROR="ROR",e.SHL="SHL",e.SHR="SHR",e.JMP="JMP",e.JZ="JZ",e.JNZ="JNZ",e.JS="JS",e.JNS="JNS",e.JO="JO",e.JNO="JNO",e.MOV="MOV",e.CMP="CMP",e.PUSH="PUSH",e.POP="POP",e.PUSHF="PUSHF",e.POPF="POPF",e.CALL="CALL",e.RET="RET",e.INT="INT",e.IRET="IRET",e.IN="IN",e.OUT="OUT",e.HALT="HALT",e.STI="STI",e.CLI="CLI",e.CLO="CLO",e.NOP="NOP",e.ORG="ORG",e.DB="DB",e))(x||{});const xs={END:0,ADD:2,SUB:2,MUL:2,DIV:2,INC:1,DEC:1,MOD:2,AND:2,OR:2,XOR:2,NOT:1,ROL:1,ROR:1,SHL:1,SHR:1,JMP:1,JZ:1,JNZ:1,JS:1,JNS:1,JO:1,JNO:1,MOV:2,CMP:2,PUSH:1,POP:1,PUSHF:0,POPF:0,CALL:1,RET:0,INT:1,IRET:0,IN:1,OUT:1,HALT:0,STI:0,CLI:0,CLO:0,NOP:0,ORG:1,DB:1};var p=(e=>(e[e.END=0]="END",e[e.ADD_REG_TO_REG=160]="ADD_REG_TO_REG",e[e.SUB_REG_FROM_REG=161]="SUB_REG_FROM_REG",e[e.MUL_REG_BY_REG=162]="MUL_REG_BY_REG",e[e.DIV_REG_BY_REG=163]="DIV_REG_BY_REG",e[e.INC_REG=164]="INC_REG",e[e.DEC_REG=165]="DEC_REG",e[e.MOD_REG_BY_REG=166]="MOD_REG_BY_REG",e[e.AND_REG_WITH_REG=170]="AND_REG_WITH_REG",e[e.OR_REG_WITH_REG=171]="OR_REG_WITH_REG",e[e.XOR_REG_WITH_REG=172]="XOR_REG_WITH_REG",e[e.NOT_REG=173]="NOT_REG",e[e.ROL_REG=154]="ROL_REG",e[e.ROR_REG=155]="ROR_REG",e[e.SHL_REG=156]="SHL_REG",e[e.SHR_REG=157]="SHR_REG",e[e.ADD_NUM_TO_REG=176]="ADD_NUM_TO_REG",e[e.SUB_NUM_FROM_REG=177]="SUB_NUM_FROM_REG",e[e.MUL_REG_BY_NUM=178]="MUL_REG_BY_NUM",e[e.DIV_REG_BY_NUM=179]="DIV_REG_BY_NUM",e[e.MOD_REG_BY_NUM=182]="MOD_REG_BY_NUM",e[e.AND_REG_WITH_NUM=186]="AND_REG_WITH_NUM",e[e.OR_REG_WITH_NUM=187]="OR_REG_WITH_NUM",e[e.XOR_REG_WITH_NUM=188]="XOR_REG_WITH_NUM",e[e.JMP=192]="JMP",e[e.JZ=193]="JZ",e[e.JNZ=194]="JNZ",e[e.JS=195]="JS",e[e.JNS=196]="JNS",e[e.JO=197]="JO",e[e.JNO=198]="JNO",e[e.MOV_NUM_TO_REG=208]="MOV_NUM_TO_REG",e[e.MOV_ADDR_TO_REG=209]="MOV_ADDR_TO_REG",e[e.MOV_REG_TO_ADDR=210]="MOV_REG_TO_ADDR",e[e.MOV_REG_ADDR_TO_REG=211]="MOV_REG_ADDR_TO_REG",e[e.MOV_REG_TO_REG_ADDR=212]="MOV_REG_TO_REG_ADDR",e[e.CMP_REG_WITH_REG=218]="CMP_REG_WITH_REG",e[e.CMP_REG_WITH_NUM=219]="CMP_REG_WITH_NUM",e[e.CMP_REG_WITH_ADDR=220]="CMP_REG_WITH_ADDR",e[e.PUSH_FROM_REG=224]="PUSH_FROM_REG",e[e.POP_TO_REG=225]="POP_TO_REG",e[e.PUSHF=234]="PUSHF",e[e.POPF=235]="POPF",e[e.CALL_ADDR=202]="CALL_ADDR",e[e.RET=203]="RET",e[e.INT_ADDR=204]="INT_ADDR",e[e.IRET=205]="IRET",e[e.IN_FROM_PORT_TO_AL=240]="IN_FROM_PORT_TO_AL",e[e.OUT_FROM_AL_TO_PORT=241]="OUT_FROM_AL_TO_PORT",e[e.HALT=0]="HALT",e[e.STI=252]="STI",e[e.CLI=253]="CLI",e[e.CLO=254]="CLO",e[e.NOP=255]="NOP",e))(p||{});const ws=256,xe=192,ys=()=>new Array(ws-xe).fill(me.Space),Ns=()=>new Array(xe).fill(0).concat(ys()),zr=e=>{const t=Ns();for(const s in e)t[s]=e[s];return t},$r=e=>e.slice(xe),jr=e=>{const t=Array.from({length:ws},(s,r)=>r<xe?x.END:"");for(const s in e){const r=Number(s),a=e[s],{instruction:o,operands:c}=a;if(o.mnemonic===x.DB){const h=c[0];typeof h.value=="number"?t[s]=h.rawValue:h.rawValue.split("").forEach((f,u)=>{t[r+u]=f})}else{t[s]=o.mnemonic;const h=r+1;c.forEach((f,u)=>{const{rawValue:E}=f;t[h+u]=f.type.endsWith("Address")?`[${E}]`:E})}}return t};var ke=(e=>(e.Hexadecimal="Hexadecimal",e.Decimal="Decimal",e.Source="Source",e))(ke||{});const Kr=Object.values(ke),Is=Ns(),Xr={data:Is,view:"Hexadecimal"},Cs=de({name:"memory",initialState:Xr,reducers:{setData:(e,t)=>{e.data=t.payload},setDataFrom:(e,t)=>{e.data=zr(t.payload)},resetData:e=>{e.data=Is},setView:(e,t)=>{e.view=t.payload}}}),pt=e=>e.memory.data,Zr=Z(pt,e=>()=>it(16,e)),Yr=Z(Rs,e=>()=>{const t=jr(e);return it(16,t)}),Ls=e=>e.memory.view,{setData:qr,setDataFrom:Ds,resetData:Qr,setView:ea}=Cs.actions;var ta=Cs.reducer;const gt=191;var se=(e=>(e[e.AL=0]="AL",e[e.BL=1]="BL",e[e.CL=2]="CL",e[e.DL=3]="DL",e))(se||{}),Ce=(e=>(e.IP="IP",e.SP="SP",e.SR="SR",e))(Ce||{});class q extends Error{constructor(){super(...arguments);k(this,"name","RuntimeError")}toPlainObject(){return{name:this.name,message:this.message}}}class sa extends q{constructor(t){super(`Invalid register '${te(t)}'.`)}}class na extends q{constructor(){super("Can not execute code beyond the end of RAM.")}}class ra extends q{constructor(){super("Stack overflow.")}}class aa extends q{constructor(){super("Stack underflow.")}}class oa extends q{constructor(){super("Can not divide by zero.")}}class ia extends q{constructor(t){super(`I/O ports between 0 and F are available, got '${te(t)}'.`)}}class ca extends q{constructor(t){super(`Input data '${te(t)}' is greater than FF.`)}}class la extends q{constructor(t){super(`Invalid opcode '${te(t)}'.`)}}const Ze=(e,t)=>t+e,Ye=(e,t)=>t-e,Gt=(e,t)=>t*e,As=e=>{if(e===0)throw new oa;return e},qe=(e,t)=>Math.floor(t/As(e)),da=e=>Ze(1,e),ua=e=>Ye(1,e),Qe=(e,t)=>t%As(e),Bt=(e,t)=>t&e,Pt=(e,t)=>t|e,Ut=(e,t)=>t^e,ha=e=>~e,pa=e=>{const t=qe(128,e);return(e<<1)+t},ga=e=>Qe(2,e)*128+(e>>1),fa=e=>e<<1,ma=e=>e>>1,ks=-1,Ra=15;var ft=(e=>(e[e.SimulatedKeyboard=0]="SimulatedKeyboard",e[e.Thermostat=3]="Thermostat",e[e.Keyboard=7]="Keyboard",e[e.NumericKeypad=8]="NumericKeypad",e))(ft||{});const ba={data:{content:null,port:null},interrupt:!1};var et=(e=>(e[e.TrafficLights=1]="TrafficLights",e[e.SevenSegmentDisplay=2]="SevenSegmentDisplay",e[e.Heater=3]="Heater",e[e.SnakeInMaze=4]="SnakeInMaze",e[e.StepperMotor=5]="StepperMotor",e[e.Lift=6]="Lift",e[e.Keyboard=7]="Keyboard",e[e.NumericKeypad=8]="NumericKeypad",e))(et||{});const va=2;var Ms=(e=>(e[e.Zero=0]="Zero",e[e.Overflow=1]="Overflow",e[e.Sign=2]="Sign",e[e.Interrupt=3]="Interrupt",e))(Ms||{});const Ea=()=>({gpr:[0,0,0,0],ip:0,sp:gt,sr:[0,0,0,0]}),_=e=>{if(e<se.AL||e>se.DL)throw new sa(e);return e},Sa=e=>{if(e>255)throw new na;return e},Ft=e=>{if(e<0)throw new ra;if(e>gt)throw new aa;return e},Le=e=>e.reduce((t,s,r)=>t+s*2**(r+1),0),Ts=(e,t)=>e[t]===1,_a=e=>e.toString(2).padStart(5,"0").slice(-5,-1).split("").map(Number).reverse(),ye=(e,t)=>{const s=[0,0,0];(t<128&&e>=128||t>=128&&e<128)&&(s[1]=1);const r=e>255?e%256:ds(e);return r===0?s[0]=1:r>=128&&(s[2]=1),[r,s]},Ht=e=>{if(e<0||e>Ra)throw new ia(e);return e},xa=e=>{if(e>255)throw new ca(e);return e},wa=(e,t)=>{const s=()=>t.data,r=()=>t.interrupt,a={},o=()=>{a.halted=!0},c=v=>{a.requiredInputPort=v},h=(v,m)=>{a.data={content:v,port:m}},f=()=>{a.closeWindows=!0},u={input:t,output:a},E={cpuRegisters:{}},L=v=>{E.memoryData=v},N=(v,m)=>{E.cpuRegisters[v]=m},C=ns(e,({memoryData:v,cpuRegisters:m})=>{const g=i=>v[i],j=(i,b)=>{v[i]=b,L({address:i,value:b})},S=i=>m.gpr[i],y=(i,b)=>{m.gpr[i]=b,N("gpr",{name:se[i],value:b})},ne=()=>m.ip,O=(i=1)=>m.ip+i,H=i=>{m.ip=i,N("ip",{value:i})},l=(i=1)=>(H(Sa(m.ip+i)),m.ip),V=i=>{j(m.sp,i);const b=Ft(m.sp-1);m.sp=b,N("sp",{value:b})},K=()=>{const i=Ft(m.sp+1);return m.sp=i,N("sp",{value:i}),g(m.sp)},re=()=>m.sr,J=i=>{Object.assign(m.sr,i),N("sr",{value:Le(m.sr)})},W=i=>Ts(m.sr,i),ge=i=>{m.sr[3]=i,N("sr",{interrupt:!0,value:Le(m.sr)})},w=(i,...b)=>{const[oe,un]=ye(i(...b),b[b.length-1]);return J(un),oe},U=r()&&W(3),ae=U?p.INT_ADDR:g(ne());switch(ae){case p.END:case p.HALT:o();break;case p.ADD_REG_TO_REG:{const i=_(g(l())),b=_(g(l()));y(i,w(Ze,S(b),S(i))),l();break}case p.SUB_REG_FROM_REG:{const i=_(g(l())),b=_(g(l()));y(i,w(Ye,S(b),S(i))),l();break}case p.MUL_REG_BY_REG:{const i=_(g(l())),b=_(g(l()));y(i,w(Gt,S(b),S(i))),l();break}case p.DIV_REG_BY_REG:{const i=_(g(l())),b=_(g(l()));y(i,w(qe,S(b),S(i))),l();break}case p.INC_REG:{const i=_(g(l()));y(i,w(da,S(i))),l();break}case p.DEC_REG:{const i=_(g(l()));y(i,w(ua,S(i))),l();break}case p.MOD_REG_BY_REG:{const i=_(g(l())),b=_(g(l()));y(i,w(Qe,S(b),S(i))),l();break}case p.AND_REG_WITH_REG:{const i=_(g(l())),b=_(g(l()));y(i,w(Bt,S(b),S(i))),l();break}case p.OR_REG_WITH_REG:{const i=_(g(l())),b=_(g(l()));y(i,w(Pt,S(b),S(i))),l();break}case p.XOR_REG_WITH_REG:{const i=_(g(l())),b=_(g(l()));y(i,w(Ut,S(b),S(i))),l();break}case p.NOT_REG:{const i=_(g(l()));y(i,w(ha,S(i))),l();break}case p.ROL_REG:{const i=_(g(l()));y(i,w(pa,S(i))),l();break}case p.ROR_REG:{const i=_(g(l()));y(i,w(ga,S(i))),l();break}case p.SHL_REG:{const i=_(g(l()));y(i,w(fa,S(i))),l();break}case p.SHR_REG:{const i=_(g(l()));y(i,w(ma,S(i))),l();break}case p.ADD_NUM_TO_REG:{const i=_(g(l())),b=g(l());y(i,w(Ze,b,S(i))),l();break}case p.SUB_NUM_FROM_REG:{const i=_(g(l())),b=g(l());y(i,w(Ye,b,S(i))),l();break}case p.MUL_REG_BY_NUM:{const i=_(g(l())),b=g(l());y(i,w(Gt,b,S(i))),l();break}case p.DIV_REG_BY_NUM:{const i=_(g(l())),b=g(l());y(i,w(qe,b,S(i))),l();break}case p.MOD_REG_BY_NUM:{const i=_(g(l())),b=g(l());y(i,w(Qe,b,S(i))),l();break}case p.AND_REG_WITH_NUM:{const i=_(g(l())),b=g(l());y(i,w(Bt,b,S(i))),l();break}case p.OR_REG_WITH_NUM:{const i=_(g(l())),b=g(l());y(i,w(Pt,b,S(i))),l();break}case p.XOR_REG_WITH_NUM:{const i=_(g(l())),b=g(l());y(i,w(Ut,b,S(i))),l();break}case p.JMP:{const i=ee(g(O()));l(i);break}case p.JZ:{const i=ee(g(O()));l(W(0)?i:2);break}case p.JNZ:{const i=ee(g(O()));l(W(0)?2:i);break}case p.JS:{const i=ee(g(O()));l(W(2)?i:2);break}case p.JNS:{const i=ee(g(O()));l(W(2)?2:i);break}case p.JO:{const i=ee(g(O()));l(W(1)?i:2);break}case p.JNO:{const i=ee(g(O()));l(W(1)?2:i);break}case p.MOV_NUM_TO_REG:{const i=_(g(l())),b=g(l());y(i,b),l();break}case p.MOV_ADDR_TO_REG:{const i=_(g(l())),b=g(l());y(i,g(b)),l();break}case p.MOV_REG_TO_ADDR:{const i=g(l()),b=_(g(l()));j(i,S(b)),l();break}case p.MOV_REG_ADDR_TO_REG:{const i=_(g(l())),b=_(g(l()));y(i,g(S(b))),l();break}case p.MOV_REG_TO_REG_ADDR:{const i=_(g(l())),b=_(g(l()));j(S(i),S(b)),l();break}case p.CMP_REG_WITH_REG:{const i=_(g(l())),b=_(g(l())),[,oe]=ye(S(i)-S(b),S(i));J(oe),l();break}case p.CMP_REG_WITH_NUM:{const i=_(g(l())),b=g(l()),[,oe]=ye(S(i)-b,S(i));J(oe),l();break}case p.CMP_REG_WITH_ADDR:{const i=_(g(l())),b=g(l()),[,oe]=ye(S(i)-g(b),S(i));J(oe),l();break}case p.PUSH_FROM_REG:{const i=_(g(l()));V(S(i)),l();break}case p.POP_TO_REG:{const i=_(g(l()));y(i,K()),l();break}case p.PUSHF:{V(Le(re())),l();break}case p.POPF:{const i=_a(K());J(i),l();break}case p.CALL_ADDR:{const i=g(O());V(O(2)),H(i);break}case p.RET:{H(K());break}case p.INT_ADDR:{if(U){V(ne()),H(g(va));break}const i=g(O());V(O(2)),H(g(i));break}case p.IRET:{H(K());break}case p.IN_FROM_PORT_TO_AL:{const i=s(),b=Ht(g(O()));if(i.content===null||i.port!==b){c(b);break}i.content!==ks&&y(se.AL,xa(i.content)),l(2);break}case p.OUT_FROM_AL_TO_PORT:{const i=S(se.AL),b=Ht(g(l()));h(i,b),l();break}case p.STI:{ge(1),l();break}case p.CLI:{ge(0),l();break}case p.CLO:{f(),l();break}case p.NOP:{l();break}default:throw new la(ae)}});return M(A({},C),{signals:u,changes:E})},Vt={status:{fault:null,halted:!1},registers:Ea()},Os=de({name:"cpu",initialState:Vt,reducers:{setFault:(e,t)=>{e.status.fault=t.payload},setHalted:e=>{e.status.halted=!0},setRegisters:(e,t)=>{e.registers=t.payload},resetState:()=>Vt}}),ya=e=>e.cpu.status,Na=e=>e.cpu.status.fault,Ia=e=>e.cpu.registers,Ca=e=>e.cpu.registers.gpr,La=e=>e.cpu.registers.ip,Da=e=>e.cpu.registers.sp,Gs=Z(La,Da,(e,t)=>({ip:e,sp:t})),Aa=e=>e.cpu.registers.sr,ka=Z(Aa,Le),{setFault:Ma,setHalted:tt,setRegisters:Ta,resetState:mt}=Os.actions;var Oa=Os.reducer,le=(e=>(e.VisualDisplayUnit="VisualDisplayUnit",e.TrafficLights="TrafficLights",e.SevenSegmentDisplay="SevenSegmentDisplay",e))(le||{});const Bs=Object.values(le),Ga=ys(),Wt=new Array(8).fill(0),Jt={inputSignals:ba,isWaitingForInput:!1,isWaitingForKeyboardInput:!1,devices:{VisualDisplayUnit:{data:Ga,isVisible:!0},TrafficLights:{data:Wt,isVisible:!1},SevenSegmentDisplay:{data:Wt,isVisible:!1}}},Ps=de({name:"io",initialState:Jt,reducers:{setInputData:(e,t)=>{const{content:s,port:r}=t.payload;e.inputSignals.data.content=s,e.inputSignals.data.port=r},clearInputData:e=>{e.inputSignals.data.content=null,e.inputSignals.data.port=null},setInterrupt:(e,t)=>{e.inputSignals.interrupt=t.payload},setWaitingForInput:(e,t)=>{e.isWaitingForInput=t.payload},setWaitingForKeyboardInput:(e,t)=>{e.isWaitingForKeyboardInput=t.payload},setVduDataFrom:(e,t)=>{const s=t.payload;e.devices.VisualDisplayUnit.data=$r(s)},setDeviceData:(e,t)=>{const{name:s,data:r}=t.payload;e.devices[s].data=lr(r)},toggleDeviceVisible:(e,t)=>{const s=t.payload;e.devices[s].isVisible=!e.devices[s].isVisible},setDevicesInvisible:e=>{Bs.forEach(t=>{e.devices[t].isVisible=!1})},resetState:e=>ls(Jt,{devices:Object.entries(e.devices).reduce((t,[s,{isVisible:r}])=>Object.assign(t,{[s]:{isVisible:r}}),{})})}}),Ba=e=>e.io.inputSignals,Pa=e=>e.io.isWaitingForInput,Ua=e=>e.io.isWaitingForKeyboardInput,Fa=e=>e.io.devices,Ha=e=>t=>t.io.devices[e].data,Va=e=>t=>t.io.devices[e].isVisible,{setInputData:Wa,clearInputData:zt,setInterrupt:$t,setWaitingForInput:jt,setWaitingForKeyboardInput:Us,setVduDataFrom:Fs,setDeviceData:Hs,toggleDeviceVisible:Vs,setDevicesInvisible:Ja,resetState:Ws}=Ps.actions;var za=Ps.reducer;const $a=null,Js=de({name:"unexpectedError",initialState:$a,reducers:{set:(e,t)=>t.payload,clear:()=>null}}),ja=e=>e.unexpectedError,{set:Rt,clear:Ka}=Js.actions;var Xa=Js.reducer;const Za=()=>{const e=new Map,t=s=>r=>a=>{var c;const o=r(a);return(c=e.get(a.type))==null||c.forEach(h=>h(a.payload,s)),o};return t.listenAction=(s,r,{once:a=!1}={})=>{const o=Rn(s);e.has(o)||e.set(o,new Set);const c=e.get(o),h=a?(u,E)=>(f(),r(u,E)):r;c.add(h);const f=()=>{c.delete(h)&&c.size===0&&e.delete(o)};return f},t},zs=Za(),{listenAction:F}=zs,Kt=Symbol("nil"),Ya=()=>{const e=new Map,t=s=>r=>a=>{const o=s.getState(),c=r(a),h=s.getState();return e.forEach((f,u)=>{f.prevSelected===Kt&&(f.prevSelected=u(o));const{prevSelected:E,callbacks:L}=f,N=u(h);N!==E&&(L.forEach(C=>C(N,s)),f.prevSelected=N)}),c};return t.watch=(s,r)=>{e.has(s)||e.set(s,{prevSelected:Kt,callbacks:new Set});const{callbacks:a}=e.get(s);return a.add(r),()=>{a.delete(r)&&a.size===0&&e.delete(s)}},t},$s=Ya(),{watch:js}=$s,qa="assembler-simulator",Ks=`persist:${qa}`,Qa=()=>{try{const e=localStorage.getItem(Ks);return JSON.parse(e!=null?e:"{}")}catch{return{}}},eo=()=>{const e=Qa();return ls({editor:lt.getInitialState(),controller:ut.getInitialState()},e)},to=e=>{try{const t=JSON.stringify(e);localStorage.setItem(Ks,t)}catch{}},so=bn({editor:Dr,assembler:Gr,controller:Jr,memory:ta,cpu:Oa,io:za,unexpectedError:Xa}),no=vn({reducer:so,middleware:e=>e().prepend(zs,$s),preloadedState:eo()}),bt=e=>R.exports.useReducer(t=>!t,e),Xt=Symbol("nil"),Xs=e=>{const t=R.exports.useRef(Xt);return t.current===Xt&&(t.current=e instanceof Function?e():e),t.current},Se=()=>{const[e,t]=R.exports.useState(null),s=R.exports.useCallback(r=>{t(r)},[]);return[e,s]},vt=e=>{const[t,s]=Se();return R.exports.useEffect(()=>{if(t===null)return;const r=a=>{const{target:o}=a;o instanceof Node&&!t.contains(o)&&e(a)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[t,e]),s},Zs=e=>{const[t,s]=Se(),[r,a]=R.exports.useState(!1),o=R.exports.useRef();return R.exports.useEffect(()=>{if(t===null)return;const c=()=>{e===void 0?a(!0):o.current=window.setTimeout(()=>{a(!0),o.current=void 0},e)},h=()=>{a(!1),o.current!==void 0&&(window.clearTimeout(o.current),o.current=void 0)};return t.addEventListener("mouseenter",c),t.addEventListener("mouseleave",h),()=>{a(!1),t.removeEventListener("mouseenter",c),t.removeEventListener("mouseleave",h)}},[t,e]),[r,s]},Ys=R.exports.createContext({currentOpen:null,setCurrentOpen:ps}),Ge=({children:e})=>{const[t,s]=Se(),r=t!==null,{currentOpen:a,setCurrentOpen:o}=R.exports.useContext(Ys),c=a!==null&&a===t,h=()=>{o(c?null:t)},[f,u]=Zs();return R.exports.useEffect(()=>{a!==null&&a!==t&&f&&o(t)},[a,t,f]),n("div",{ref:s,className:P("flex items-center hover:bg-gray-200",{"bg-gray-200":c}),onClick:h,children:r&&e(c,u,t)})},qs="flex space-x-2 items-center",ro=({children:e})=>n("div",{className:qs,children:e}),ao=({children:e,innerRef:t})=>n("div",{ref:t,className:P(qs,"py-1 px-2"),children:e});var D=Object.assign(ro,{Main:ao});const Qs="divide-y border bg-gray-50 shadow fixed",oo=({menuElement:e,children:t})=>n("div",{ref:r=>{if(r===null)return;const{bottom:a,left:o}=e.getBoundingClientRect();r.style.top=`${a-1}px`,r.style.left=`${o}px`},className:Qs,children:t}),io=({innerRef:e,menuItemElement:t,children:s})=>n("div",{ref:a=>{if(e(a),a===null)return;const{top:o,right:c}=t.getBoundingClientRect(),h=t.offsetTop===0;a.style.top=`${o-(h?1:0)}px`,a.style.left=`${c}px`},className:Qs,children:s});var Q=Object.assign(oo,{Expanded:io});const we=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M20.285 2l-11.285 11.567-5.286-5.011-3.714 3.716 9 8.728 15-15.285z"})})),co=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M15.602 4.075c2.201 1.174 4.904 3.254 6.398 5.252-1.286-.9-3.011-1.027-5.058-.549.222-1.469-.185-3.535-1.34-4.703zm-.825 6.925s1.522-7-3.335-7h-5.442v20h16v-10.629c0-3.42-4.214-3.116-7.223-2.371zm-.777-9l-3-2h-9v22h2v-20h10z"})})),lo=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M1.004 6.251l10.996-5.998 10.99 6.06-10.985 5.861-11.001-5.923zm11.996 7.676v9.82l10-5.362v-9.82l-10 5.362zm-2 0l-10-5.411v9.869l10 5.362v-9.82z"})})),uo=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M507.73 109.1c-2.24-9.03-13.54-12.09-20.12-5.51l-74.36 74.36-67.88-11.31-11.31-67.88 74.36-74.36c6.62-6.62 3.43-17.9-5.66-20.16-47.38-11.74-99.55.91-136.58 37.93-39.64 39.64-50.55 97.1-34.05 147.2L18.74 402.76c-24.99 24.99-24.99 65.51 0 90.5 24.99 24.99 65.51 24.99 90.5 0l213.21-213.21c50.12 16.71 107.47 5.68 147.37-34.22 37.07-37.07 49.7-89.32 37.91-136.73zM64 472c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"})})),ho=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M13 7v-6l11 11-11 11v-6h-13v-10z"})})),en=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M3 22v-20l18 10-18 10z"})})),po=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M2 2h20v20h-20z"})})),go=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M14 12l-14 9v-18l14 9zm-4-9v4l8.022 5-8.022 5v4l14-9-14-9z"})})),fo=e=>d("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:[n("path",{d:"M17.026 22.957c10.957-11.421-2.326-20.865-10.384-13.309l2.464 2.352h-9.106v-8.947l2.232 2.229c14.794-13.203 31.51 7.051 14.794 17.675z"})," "]})),mo=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M14.601 21.5c0 1.38-1.116 2.5-2.499 2.5-1.378 0-2.499-1.12-2.499-2.5s1.121-2.5 2.499-2.5c1.383 0 2.499 1.119 2.499 2.5zm-2.42-21.5c-4.029 0-7.06 2.693-7.06 8h3.955c0-2.304.906-4.189 3.024-4.189 1.247 0 2.57.828 2.684 2.411.123 1.666-.767 2.511-1.892 3.582-2.924 2.78-2.816 4.049-2.816 7.196h3.943c0-1.452-.157-2.508 1.838-4.659 1.331-1.436 2.986-3.222 3.021-5.943.047-3.963-2.751-6.398-6.697-6.398z"})})),Ro=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"})})),bo=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 480 512",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"})})),tn=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M0 16.67l2.829 2.83 9.175-9.339 9.167 9.339 2.829-2.83-11.996-12.17z"})})),sn=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M0 7.33l2.829-2.83 9.175 9.339 9.167-9.339 2.829 2.83-11.996 12.17z"})})),vo=e=>d("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:[n("path",{d:"M23.954 21.03l-9.184-9.095 9.092-9.174-2.832-2.807-9.09 9.179-9.176-9.088-2.81 2.81 9.186 9.105-9.095 9.184 2.81 2.81 9.112-9.192 9.18 9.1z"})," "]})),Eo=e=>d("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:[n("path",{clipRule:"evenodd",d:"M12 19C15.866 19 19 15.866 19 12C19 8.13401 15.866 5 12 5C8.13401 5 5 8.13401 5 12C5 15.866 8.13401 19 12 19ZM12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z",fill:"currentColor",fillRule:"evenodd",opacity:"0.2"}),n("path",{d:"M2 12C2 6.47715 6.47715 2 12 2V5C8.13401 5 5 8.13401 5 12H2Z",fill:"currentColor"})]})),Et="flex space-x-4 py-1 px-2 items-center justify-between hover:bg-gray-200",So=({onClick:e,children:t})=>d("div",{className:Et,onClick:e,children:[t,n("span",{className:"w-4"})]}),_o=({href:e,children:t})=>d("div",{className:Et,onClick:()=>{window.open(e,"_blank","noreferrer")},children:[t,n("div",{className:"w-4",children:n(Ro,{className:"mx-auto fill-gray-400 w-3.5"})})]}),xo=({children:e})=>{const[t,s]=Se(),r=t!==null,[a,o]=Zs(100),c=E=>{s(E),o(E)},[h,f]=Se();return n("div",{ref:c,className:Et,onClick:E=>{h!==null&&!h.contains(E.target)&&E.stopPropagation()},children:r&&d(G,{children:[n("div",{children:e(a,f,t)}),n("div",{className:"w-4",children:n(en,{className:"mx-auto w-2.5"})})]})})};var B=Object.assign(So,{ExternalLink:_o,Expandable:xo});const T=En,I=Sn,wo=()=>{const e=T();return n(B,{onClick:()=>{e.dispatch(Y({value:Je.content,isFromFile:!0}))},children:d(D,{children:[n("span",{className:"w-4"}),n("span",{children:"New File"})]})})},yo=({onFileLoad:e})=>{const t=R.exports.useRef(null),s=h=>{h.stopPropagation(),t.current.click()},r=h=>{h.stopPropagation()},a=T(),o=h=>{const f=new FileReader;f.onload=function(){const u=this.result;a.dispatch(Y({value:u,isFromFile:!0}))},f.readAsText(h)};return d(B,{onClick:s,children:[d(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Open..."})]}),n("input",{ref:t,className:"hidden",type:"file",onChange:({target:h})=>{const f=h.files[0];o(f),e()},onClick:r})]})},No=()=>{const e=T();return n(B.Expandable,{children:(t,s,r)=>d(G,{children:[d(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Open Example"})]}),t&&n(Q.Expanded,{innerRef:s,menuItemElement:r,children:is.map(({title:a,content:o},c)=>n(B,{onClick:()=>{e.dispatch(Y({value:o,isFromFile:!0}))},children:d(D,{children:[n("span",{className:"w-4"}),n("span",{children:a})]})},c))})]})})},Io=()=>{const e=T();return n(B,{onClick:()=>{const s=_e(e.getState()),r=new Blob([s],{type:"application/octet-stream"}),a=URL.createObjectURL(r);Object.assign(document.createElement("a"),{download:"file.asm",href:a}).click(),URL.revokeObjectURL(a)},children:d(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Save As..."})]})})},Co=()=>n(Ge,{children:(e,t,s)=>d(G,{children:[d(D.Main,{innerRef:t,children:[n(co,{}),n("span",{children:"File"})]}),e&&d(Q,{menuElement:s,children:[n(wo,{}),n(yo,{onFileLoad:()=>s.click()}),n(No,{}),n(Io,{})]})]})}),Lo=()=>{const e=T(),t=I(Ls);return n(B.Expandable,{children:(s,r,a)=>d(G,{children:[d(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Memory"})]}),s&&n(Q.Expanded,{innerRef:r,menuItemElement:a,children:Kr.map((o,c)=>n(B,{onClick:()=>{e.dispatch(ea(o))},children:d(D,{children:[t===o?n(we,{}):n("span",{className:"w-4"}),n("span",{children:o})]})},c))})]})})},Do=()=>{const e=T(),t=I(Fa);return n(B.Expandable,{children:(s,r,a)=>d(G,{children:[d(D,{children:[n("span",{className:"w-4"}),n("span",{children:"I/O Devices"})]}),s&&n(Q.Expanded,{innerRef:r,menuItemElement:a,children:Bs.map((o,c)=>n(B,{onClick:()=>{e.dispatch(Vs(o))},children:d(D,{children:[t[o].isVisible?n(we,{}):n("span",{className:"w-4"}),n("span",{children:ur(o)})]})},c))})]})})},Ao=()=>n(Ge,{children:(e,t,s)=>d(G,{children:[d(D.Main,{innerRef:t,children:[n(lo,{}),n("span",{children:"View"})]}),e&&d(Q,{menuElement:s,children:[n(Lo,{}),n(Do,{})]})]})}),ko=()=>{const e=T(),t=I(Ke);return n(B,{onClick:()=>{e.dispatch(_s(!t))},children:d(D,{children:[t?n(we,{}):n("span",{className:"w-4"}),n("span",{children:"Auto Assemble"})]})})},Mo=()=>{const e=T(),t=I(Es);return n(B.Expandable,{children:(s,r,a)=>d(G,{children:[d(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Clock Speed"})]}),s&&n(Q.Expanded,{innerRef:r,menuItemElement:a,children:Br.map((o,c)=>n(B,{onClick:()=>{e.dispatch(Vr($e[o]))},children:d(D,{children:[t===$e[o]?n(we,{}):n("span",{className:"w-4"}),n("span",{children:o})]})},c))})]})})},To=()=>{const e=T(),t=I(Ss);return n(B.Expandable,{children:(s,r,a)=>d(G,{children:[d(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Timer Interval"})]}),s&&n(Q.Expanded,{innerRef:r,menuItemElement:a,children:Pr.map((o,c)=>n(B,{onClick:()=>{e.dispatch(Wr(je[o]))},children:d(D,{children:[t===je[o]?n(we,{}):n("span",{className:"w-4"}),n("span",{children:o})]})},c))})]})})},Oo=()=>n(Ge,{children:(e,t,s)=>d(G,{children:[d(D.Main,{innerRef:t,children:[n(uo,{}),n("span",{children:"Configuration"})]}),e&&d(Q,{menuElement:s,children:[n(ko,{}),n(Mo,{}),n(To,{})]})]})});var X=(e=>(e.Whitespace="Whitespace",e.Comment="Comment",e.Colon="Colon",e.Comma="Comma",e.Digits="Digits",e.Register="Register",e.Address="Address",e.String="String",e.Unknown="Unknown",e))(X||{});const Go=(e,t,s)=>{const r=ct(()=>{switch(e){case"Register":case"Unknown":return t.toUpperCase();case"Address":return ot(t).trim().toUpperCase();case"String":return JSON.parse(t);default:return t}}),a=s+t.length;return{type:e,value:r,raw:t,range:{from:s,to:a}}},Bo=e=>{const t=Object.entries(e),s=new RegExp(t.map(([,a])=>`(${a.source})`).join("|"),"y");let r="";return{reset:a=>{r=a,s.lastIndex=0},next:()=>{const a=s.lastIndex,o=s.exec(r);if(o!==null&&o.index===a){for(let c=0;;c++)if(o[c+1]!==void 0){const[h]=t[c];return Go(h,o[0],a)}}if(s.lastIndex=a,a<r.length)throw new Error(`Unexpected token '${r[a]}' at index ${a}.`);return null}}},Zt=Bo({Whitespace:/\s+/,Comment:/;.*/,Colon:/:/,Comma:/,/,Digits:/\d+\b/,Register:/[a-dA-D][lL]\b/,Address:/\[.*?\]/,String:/"(?:[^\\\r\n]|\\.)*?"/,Unknown:/[^\s;:,["]+|\[.*?(?=\s*?(?:[\r\n;:,]|$))|".*/}),Po=e=>{Zt.reset(e);const t=[];let s;for(;(s=Zt.next())!==null&&!(s.type!=="Whitespace"&&s.type!=="Comment"&&(t.push(s),s.value===x.END)););return t};class St extends Error{constructor(s,r){super(s);k(this,"range");this.range=r}toPlainObject(){return{name:this.name,message:this.message,range:this.range}}}class z extends St{constructor(s,r){super(br(gr(s)),r);k(this,"name","ParseError")}}class Uo extends z{constructor({raw:t,range:s},r){super(`Expected ${r?"":"label or "}instruction, got '${t}'.`,s)}}class Fo extends z{constructor({raw:t,range:s}){const r=t.replace(/:$/,"");super(`Label should contain only letter or underscore, got '${r}'.`,s)}}class Be extends z{constructor(){super("Expected END at the end of the source code.")}}class Ho extends z{constructor({raw:t,range:s}){const r=ot(t).trim();super(`Number '${r}' is greater than FF.`,s)}}class Vo extends z{constructor({value:t,range:s},r){super(`UTF-16 code of character '${t[r]}' is greater than FF.`,s)}}class Wo extends z{constructor({raw:t,range:s}){const r=ot(t).trim();super(`Expected number or register, got '${r.length>0?r:"]"}'.`,s)}}class Jo extends z{constructor({raw:t,range:s}){super(`Unterminated address '${t.trimEnd()}'.`,s)}}class zo extends z{constructor({raw:t,range:s}){super(`Unterminated string '${t}'.`,s)}}class $o extends z{constructor({range:t}){super("Single quote is not allowed.",t)}}class jo extends z{constructor({raw:t,range:s},...r){const a=r.map(o=>o.replace(/[A-Z]/g,c=>` ${c.toLowerCase()}`).trimStart()).reduce((o,c,h)=>{switch(h){case 0:return c;case r.length-1:return`${o} or ${c}`;default:return`${o}, ${c}`}},"");super(`Expected ${a}, got '${t}'.`,s)}}class Ko extends z{constructor({raw:t,range:s}){super(`Expected comma, got '${t}'.`,s)}}class Pe extends St{constructor(){super(...arguments);k(this,"name","AssembleError")}}class Xo extends Pe{constructor({identifier:t,range:s}){super(`Duplicate label '${t}'.`,s)}}class Zo extends Pe{constructor({range:t}){super("Can not generate code beyond the end of RAM.",t)}}class Yo extends Pe{constructor({raw:t,range:s}){super(`Label '${t}' does not exist.`,s)}}class qo extends Pe{constructor({range:t}){super("Jump distance should be between -128 and 127.",t)}}const Qo=({value:e,range:t})=>({identifier:e,range:t}),ei=({value:e,range:t})=>({mnemonic:e,opcode:null,range:t});var _t=(e=>(e.Number="Number",e.Register="Register",e.Address="Address",e.RegisterAddress="RegisterAddress",e.String="String",e.Label="Label",e))(_t||{});const ti=(e,t)=>{const s=ct(()=>{switch(e){case"Number":case"Address":return hs(t.value);case"Register":case"RegisterAddress":return se[t.value];case"String":return vr(t.value);case"Label":return}}),{value:r,raw:a,range:o}=t;return{type:e,value:s,rawValue:r,raw:a,range:o}},si=(e,t,s)=>{const r=[];t.opcode!==null&&r.push(t.opcode),s.forEach(h=>{h.value!==void 0&&(typeof h.value=="number"?r.push(h.value):r.push(...h.value))});const a=t.range.from,c=(s.length>0?s[s.length-1]:t).range.to;return{label:e,instruction:t,operands:s,machineCode:r,range:{from:a,to:c}}},ni=/^[A-Z_]+$/,nn=e=>{if(!ni.test(e.value))throw new Fo(e);return e},ri=(e,t)=>{var s;return((s=e[t+1])==null?void 0:s.type)!==X.Colon?null:Qo(nn(e[t]))},Ve=e=>{if(hs(e.value)>255)throw new Ho(e);return e},ai=e=>{for(let t=0;t<e.value.length;t++)if(e.value.charCodeAt(t)>255)throw new Vo(e,t);return e},Yt=/^[\dA-F]+$/,oi=/^[A-D]L$/,st=(e,t)=>(...s)=>{if(t>=e.length)throw new Be;const r=e[t],a=c=>s.includes(c),o=(c,h)=>ti(c,h);switch(r.type){case X.Digits:if(a("Number"))return o("Number",Ve(r));break;case X.Register:if(a("Register"))return o("Register",r);break;case X.Address:if(a("Address")){if(Yt.test(r.value))return o("Address",Ve(r));if(oi.test(r.value))return o("RegisterAddress",r);throw new Wo(r)}break;case X.String:if(a("String"))return o("String",ai(r));break;case X.Unknown:if(r.raw.startsWith("["))throw new Jo(r);if(r.raw.startsWith('"'))throw new zo(r);if(r.raw.startsWith("'"))throw new $o(r);if(a("Number")&&Yt.test(r.value))return o("Number",Ve(r));if(a("Label"))return o("Label",nn(r));break}throw new jo(r,...s)},ii=(e,t)=>{if(t>=e.length)return new Be;const s=e[t];return s.type!==X.Comma?new Ko(s):null},ci=(e,t)=>(...s)=>{const r=[];s.forEach(([f])=>{r.includes(f)||r.push(f)});const a=st(e,t)(...r),o=ii(e,t+1);if(o!==null)throw o;const c=[];s.forEach(([f,u])=>{f===a.type&&c.push(u)});const h=st(e,t+2)(...c);return[a,h]},li=(e,t)=>{const s=()=>t+r;let r=0;const a=v=>{r+=v},o=ri(e,s()),c=o!==null;c&&a(2);const h=e[s()];if(h===void 0)throw new Be;if(h.type!==X.Unknown||!(h.value in x))throw new Uo(h,c);a(1);const f=ei(h),u=v=>{f.opcode=v},E=[],L=(...v)=>{E.push(...v)},N=h.value;switch(xs[N]){case 0:{u(p[N]);break}case 1:{let v;const m=st(e,s());switch(N){case x.INC:u(p.INC_REG),v=m("Register");break;case x.DEC:u(p.DEC_REG),v=m("Register");break;case x.NOT:u(p.NOT_REG),v=m("Register");break;case x.ROL:u(p.ROL_REG),v=m("Register");break;case x.ROR:u(p.ROR_REG),v=m("Register");break;case x.SHL:u(p.SHL_REG),v=m("Register");break;case x.SHR:u(p.SHR_REG),v=m("Register");break;case x.JMP:u(p.JMP),v=m("Label");break;case x.JZ:u(p.JZ),v=m("Label");break;case x.JNZ:u(p.JNZ),v=m("Label");break;case x.JS:u(p.JS),v=m("Label");break;case x.JNS:u(p.JNS),v=m("Label");break;case x.JO:u(p.JO),v=m("Label");break;case x.JNO:u(p.JNO),v=m("Label");break;case x.PUSH:u(p.PUSH_FROM_REG),v=m("Register");break;case x.POP:u(p.POP_TO_REG),v=m("Register");break;case x.CALL:u(p.CALL_ADDR),v=m("Number");break;case x.INT:u(p.INT_ADDR),v=m("Number");break;case x.IN:u(p.IN_FROM_PORT_TO_AL),v=m("Number");break;case x.OUT:u(p.OUT_FROM_AL_TO_PORT),v=m("Number");break;case x.ORG:v=m("Number");break;case x.DB:v=m("Number","String");break}L(v),a(1);break}case 2:{let v,m;const g=ci(e,s());switch(N){case x.ADD:switch([v,m]=g(["Register","Register"],["Register","Number"]),m.type){case"Register":u(p.ADD_REG_TO_REG);break;case"Number":u(p.ADD_NUM_TO_REG);break}break;case x.SUB:switch([v,m]=g(["Register","Register"],["Register","Number"]),m.type){case"Register":u(p.SUB_REG_FROM_REG);break;case"Number":u(p.SUB_NUM_FROM_REG);break}break;case x.MUL:switch([v,m]=g(["Register","Register"],["Register","Number"]),m.type){case"Register":u(p.MUL_REG_BY_REG);break;case"Number":u(p.MUL_REG_BY_NUM);break}break;case x.DIV:switch([v,m]=g(["Register","Register"],["Register","Number"]),m.type){case"Register":u(p.DIV_REG_BY_REG);break;case"Number":u(p.DIV_REG_BY_NUM);break}break;case x.MOD:switch([v,m]=g(["Register","Register"],["Register","Number"]),m.type){case"Register":u(p.MOD_REG_BY_REG);break;case"Number":u(p.MOD_REG_BY_NUM);break}break;case x.AND:switch([v,m]=g(["Register","Register"],["Register","Number"]),m.type){case"Register":u(p.AND_REG_WITH_REG);break;case"Number":u(p.AND_REG_WITH_NUM);break}break;case x.OR:switch([v,m]=g(["Register","Register"],["Register","Number"]),m.type){case"Register":u(p.OR_REG_WITH_REG);break;case"Number":u(p.OR_REG_WITH_NUM);break}break;case x.XOR:switch([v,m]=g(["Register","Register"],["Register","Number"]),m.type){case"Register":u(p.XOR_REG_WITH_REG);break;case"Number":u(p.XOR_REG_WITH_NUM);break}break;case x.MOV:switch([v,m]=g(["Register","Number"],["Register","Address"],["Address","Register"],["Register","RegisterAddress"],["RegisterAddress","Register"]),v.type){case"Register":switch(m.type){case"Number":u(p.MOV_NUM_TO_REG);break;case"Address":u(p.MOV_ADDR_TO_REG);break;case"RegisterAddress":u(p.MOV_REG_ADDR_TO_REG);break}break;case"Address":u(p.MOV_REG_TO_ADDR);break;case"RegisterAddress":u(p.MOV_REG_TO_REG_ADDR)}break;case x.CMP:switch([v,m]=g(["Register","Register"],["Register","Number"],["Register","Address"]),m.type){case"Register":u(p.CMP_REG_WITH_REG);break;case"Number":u(p.CMP_REG_WITH_NUM);break;case"Address":u(p.CMP_REG_WITH_ADDR);break}break}L(v,m),a(3);break}}return[si(o,f,E),r]},di=e=>{const t=[];for(let s=0;s<e.length;){const[r,a]=li(e,s);t.push(r),s+=a}if(t.length>0&&t[t.length-1].instruction.mnemonic!==x.END)throw new Be;return t},ui=e=>{let t=0;const s={};return e.forEach((r,a)=>{const{label:o,instruction:c,operands:h,machineCode:f}=r;if(o!==null){if(o.identifier in s)throw new Xo(o);s[o.identifier]=t}const u=h[0];if(c.mnemonic===x.ORG)t=u.value;else if(t+=f.length+((u==null?void 0:u.type)===_t.Label?1:0),t>255&&a!==e.length-1)throw new Zo(r)}),s},hi=e=>{const t=di(Po(e)),s=ui(t);let r=0;const a={},o={};return t.forEach(c=>{const{instruction:h,operands:f,machineCode:u}=c,E=f[0];if(h.mnemonic===x.ORG){r=E.value;return}if((E==null?void 0:E.type)===_t.Label){if(!(E.rawValue in s))throw new Yo(E);const N=s[E.rawValue]-r;if(N<-128||N>127)throw new qo(E);const C=ds(N);E.value=C,u.push(C)}const L=r+u.length;u.forEach((N,C)=>{a[r+C]=N}),o[r]=c,r=L}),[a,o]},rn=e=>(t=_e(e.getState()))=>{let s;try{s=hi(t)}catch(h){if(h instanceof St){const f=h.toPlainObject();e.dispatch(ve()),e.dispatch(Mr(f))}else{const f=Oe(h);e.dispatch(Rt(f))}return}const[r,a]=s,o=a[0],c=o!==void 0;e.dispatch(Ds(r)),e.dispatch(mt()),e.dispatch(vs({source:t,addressToStatementMap:a})),e.dispatch(c?fs(o):ve())},pi={type:ie.Warning,content:"Warning: Source code has changed since last assemble."};class gi{constructor(t){k(this,"getState");k(this,"dispatch");k(this,"stepIntervalId");k(this,"interruptIntervalId");k(this,"isInterruptIntervalSet",!1);k(this,"lastStep",Promise.resolve(void 0));k(this,"dispatchChangesTimeoutId");k(this,"unsubscribeSetSuspended");k(this,"lastBreakpointLineNumber");k(this,"assemble");k(this,"runOrStop",async()=>{this.stopIfRunning(this.getState())||await this.run()});k(this,"stopAndRun",async()=>{this.cancelMainLoop(),this.resumeMainLoop(),await this.step()});k(this,"step",async()=>{const t=await this.lastStep,s=this.getState();_e(s)!==Ar(s)&&this.dispatch(ze(pi));const{fault:r,halted:a}=ya(s);if(r!==null||a){this.stopIfRunning(s),r===null&&a&&this.dispatch(tt());return}he(s)||(this.lastStep=new Promise(o=>{var W,ge;let c;try{c=wa(t!=null?t:{memoryData:pt(s),cpuRegisters:Ia(s)},Ba(s))}catch(w){if(this.stopIfRunning(s),w instanceof q){const U=w.toPlainObject();this.dispatch(Ma(U))}else{const U=Oe(w);this.dispatch(Rt(U))}o(void 0);return}const{memoryData:h,cpuRegisters:f,signals:u,changes:E}=c,L=f.ip,C=Rs(s)[L],v=C==null?void 0:C.machineCode.every((w,U)=>w===h[L+U]);let m=!1;if(E.memoryData!==void 0){const{address:w}=E.memoryData;w>=xe&&(m=!0)}const g=()=>{this.dispatchChangesTimeoutId=window.setTimeout(()=>{this.dispatch(qr(h)),m&&this.dispatch(Fs(h)),this.dispatch(Ta(f)),this.dispatch(v?fs(C):ve()),this.dispatchChangesTimeoutId=void 0})};let j=!1;(this.dispatchChangesTimeoutId===void 0||m)&&(j=!0,g());const{data:S,interrupt:y}=u.input,{halted:ne=!1,requiredInputPort:O,data:H,closeWindows:l=!1}=u.output;if(y&&this.dispatch($t(!1)),ne){this.stopIfRunning(s),this.dispatch(tt()),o(void 0);return}const V=Ee(s);let K=!1;if(O!==void 0)if(this.dispatch(jt(!0)),S.content===null){switch(K=!0,V&&this.cancelMainLoop(),this.dispatch(Ie(!0)),O){case ft.SimulatedKeyboard:this.dispatch(Us(!0));break}this.unsubscribeSetSuspended=F(Ie,async()=>{V&&this.resumeMainLoop(),await this.step()},{once:!0})}else this.dispatch(zt());else Pa(s)&&(this.dispatch(jt(!1)),this.dispatch(zt()));if((H==null?void 0:H.content)!==void 0){const{content:w,port:U}=H,ae=ct(()=>{switch(U){case et.TrafficLights:return le.TrafficLights;case et.SevenSegmentDisplay:return le.SevenSegmentDisplay}});ae!==void 0&&this.dispatch(Hs({name:ae,data:w}))}if(V){const w=Ts(f.sr,Ms.Interrupt);((ge=(W=E.cpuRegisters.sr)==null?void 0:W.interrupt)!=null?ge:!1)?w?this.isInterruptIntervalSet||(this.setInterruptInterval(),this.isInterruptIntervalSet=!0):this.isInterruptIntervalSet&&(this.clearInterruptInterval(),this.isInterruptIntervalSet=!1):w&&!this.isInterruptIntervalSet&&(this.setInterruptInterval(),this.isInterruptIntervalSet=!0)}l&&this.dispatch(Ja());const re=dt(s);let J=!1;if(re.length>0&&v&&V&&!K){const{label:w,range:U}=C,ae={from:w===null?U.from:w.range.from,to:U.to},i=re.find(b=>Qn(b,ae));i!==void 0&&(J=!0,i.number!==this.lastBreakpointLineNumber&&(j||g(),this.stop(),this.lastBreakpointLineNumber=i.number))}!J&&this.lastBreakpointLineNumber!==void 0&&this.resetBreakpointLineNumber(),o({memoryData:h,cpuRegisters:f})}))});k(this,"reset",()=>{this.fullyStop(),this.dispatch(Qr()),this.dispatch(mt()),this.dispatch(Or()),this.dispatch(ve()),this.dispatch(Ws())});k(this,"fullyStop",()=>{const t=this.getState();this.stopIfRunning(t),this.cancelDispatchChanges(),this.restoreIfSuspended(t),this.resetBreakpointLineNumber(),this.resetLastStep()});this.getState=t.getState,this.dispatch=t.dispatch;const s=rn(t);this.assemble=()=>s()}stopIfRunning(t){const s=Ee(t);return s&&this.stop(),s}stop(){this.clearStepInterval(),this.isInterruptIntervalSet&&(this.clearInterruptInterval(),this.isInterruptIntervalSet=!1),this.dispatch(Ot(!1))}clearStepInterval(){window.clearInterval(this.stepIntervalId)}clearInterruptInterval(){window.clearInterval(this.interruptIntervalId)}restoreIfSuspended(t){he(t)&&(this.unsubscribeSetSuspended(),this.dispatch(Ie(!1)))}async run(){this.dispatch(Ot(!0)),this.setStepInterval(),await this.step()}setStepInterval(){const{clockSpeed:t}=Xe(this.getState());this.stepIntervalId=window.setInterval(this.step,1e3/t)}cancelMainLoop(){this.clearStepInterval(),this.isInterruptIntervalSet&&this.clearInterruptInterval()}resumeMainLoop(){this.setStepInterval(),this.isInterruptIntervalSet&&this.setInterruptInterval()}setInterruptInterval(){const{timerInterval:t}=Xe(this.getState());this.interruptIntervalId=window.setInterval(()=>{this.dispatch($t(!0))},t)}resetBreakpointLineNumber(){this.lastBreakpointLineNumber=void 0}cancelDispatchChanges(){this.dispatchChangesTimeoutId!==void 0&&(window.clearTimeout(this.dispatchChangesTimeoutId),this.dispatchChangesTimeoutId=void 0)}resetLastStep(){this.lastStep=Promise.resolve(void 0)}}const fi=()=>{const e=T(),t=Xs(()=>new gi(e));return R.exports.useEffect(()=>F(Y,t.fullyStop),[]),R.exports.useEffect(()=>F(_s,s=>{s&&window.setTimeout(()=>{t.assemble()},ht)}),[]),R.exports.useEffect(()=>F(vs,t.fullyStop),[]),R.exports.useEffect(()=>js(Xe,async(s,r)=>{const a=r.getState();!he(a)&&Ee(a)&&await t.stopAndRun()}),[]),t},Ne=({children:e,onClick:t,disabled:s=!1})=>n("div",{className:P("flex space-x-2 py-1 px-2 items-center",s?"text-gray-400 fill-gray-400":"hover:bg-gray-200"),onClick:s?void 0:t,children:e}),mi=()=>{const e=fi();return d(G,{children:[n(()=>d(Ne,{onClick:e.assemble,children:[n(ho,{}),n("span",{children:"Assemble"})]}),{}),n(()=>{const o=I(Ee),c=I(he);return n(Ne,{disabled:c,onClick:e.runOrStop,children:o?d(G,{children:[n(po,{}),n("span",{children:"Stop"})]}):d(G,{children:[n(en,{}),d("span",{children:["Run",ue]})]})})},{}),n(()=>{const o=I(Ee),c=I(he);return d(Ne,{disabled:o||c,onClick:e.step,children:[n(go,{}),n("span",{children:"Step"})]})},{}),n(()=>d(Ne,{onClick:e.reset,children:[n(fo,{}),n("span",{children:"Reset"})]}),{})]})},qt=document.getElementById("modal-root"),xt=({children:e,isOpen:t=!1,className:s=""})=>{const r=R.exports.useRef(),[a,o]=R.exports.useState(!1),c=t&&a;return R.exports.useEffect(()=>{if(!t)return;if(r.current===void 0){const f=document.createElement("div");f.className=s,r.current=f}const{current:h}=r;return qt.appendChild(h),o(!0),()=>{qt.removeChild(h),o(!1)}},[t,s]),c?_n.exports.createPortal(e,r.current):null},Re=({href:e,children:t})=>{const s=e.startsWith("http");return n("a",M(A({className:"text-blue-700 hover:underline",href:e},s?{rel:"noopener noreferrer",target:"_blank"}:void 0),{children:t}))},Ri=()=>n(B.ExternalLink,{href:"http://www.softwareforeducation.com/sms32v50/sms32v50_manual/250-FullIset.htm",children:d(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Instruction Set"})]})}),bi=()=>n(B.ExternalLink,{href:"https://github.com/exuanbo/assembler-simulator/issues",children:d(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Bug Report"})]})}),vi=({onClick:e})=>n(B,{onClick:e,children:d(D,{children:[n("span",{className:"w-4"}),n("span",{children:"About"})]})}),Ei=({isOpen:e,toggleOpen:t})=>{const s=vt(t);return n(xt,{className:"bg-black flex bg-opacity-20 inset-0 fixed items-center justify-center",isOpen:e,children:d("div",{ref:s,className:"rounded space-y-2 bg-light-100 shadow text-center py-4 px-8 select-text all:select-text",onClick:a=>{a.stopPropagation()},children:[n("img",{alt:"icon",className:"mx-auto",height:"72",src:"./pwa-192x192.png",width:"72"}),n("div",{className:"font-bold",children:"Assembler Simulator"}),d("div",{className:"space-y-4 text-sm",children:[d("div",{children:[d("div",{children:["Version ","1.0.0-alpha.1"]}),d("div",{children:["Build"," ",n(Re,{href:"https://github.com/exuanbo/assembler-simulator/commits/2568316",children:"2568316"})]})]}),d("div",{children:[n(Re,{href:"https://github.com/exuanbo/assembler-simulator/blob/main/LICENSE",children:"GPL-3.0 License"})," ",n("span",{className:"font-sans",children:"\xA9"})," 2022"," ",n(Re,{href:"https://github.com/exuanbo",children:"Exuanbo"})]})]})]})})},Si=()=>{const[e,t]=bt(!1);return n(Ge,{children:(s,r,a)=>d(G,{children:[n(D.Main,{innerRef:r,children:n(mo,{})}),s&&d(Q,{menuElement:a,children:[n(Ri,{}),n(bi,{}),n(vi,{onClick:t})]}),n(Ei,{isOpen:e,toggleOpen:t})]})})},_i=()=>{const[e,t]=R.exports.useState(null),s=R.exports.useMemo(()=>({currentOpen:e,setCurrentOpen:t}),[e]),r=R.exports.useCallback(()=>{e!==null&&t(null)},[e]),a=vt(r);return R.exports.useEffect(()=>{a(e)},[e]),d("div",{className:"border-y flex flex-row-reverse min-w-max bg-gray-100 h-8 w-full z-10 fixed items-center justify-between",children:[d(D.Main,{children:[n("h1",{children:"Assembler Simulator"}),n(Re,{href:"https://github.com/exuanbo/assembler-simulator",children:n(bo,{className:"w-4.5"})})]}),n("div",{className:"divide-x border-r flex",children:d(Ys.Provider,{value:s,children:[n(Co,{}),n(Ao,{}),n(Oo,{}),n(mi,{}),n(Si,{})]})})]})},xi=.25,Qt=.75,wi=({children:e,className:t})=>{const[s,r]=e,[a,o]=R.exports.useState(),c=a!==void 0,h=R.exports.useRef(null),f=R.exports.useRef(null),u=R.exports.useRef(null),E=()=>f.current.offsetWidth,L=()=>h.current.offsetWidth-E(),N=()=>.5*L(),C=()=>L()-u.current.offsetWidth;R.exports.useEffect(()=>{o(N())},[]),R.exports.useEffect(()=>{if(!c)return;const y=C();a>y&&o(y)},[c,a]);const[v,m]=R.exports.useState(!1),g=R.exports.useRef(0),j=R.exports.useRef(),S=()=>{m(!0),g.current+=1,g.current===2?(o(N()),window.clearTimeout(j.current),g.current=0):j.current=window.setTimeout(()=>{g.current=0},500)};return R.exports.useEffect(()=>{if(!v)return;const y=xr(O=>{const H=E(),l=O.clientX-H/2,V=L(),K=l/V,re=dr(K,xi,Qt),J=re*V;if(re===Qt){const W=C();if(J>W){o(W);return}}o(J)},10),ne=()=>{m(!1)};return document.addEventListener("mousemove",y),document.addEventListener("mouseup",ne),()=>{document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",ne)}},[v]),d(G,{children:[d("div",{ref:h,className:P("flex",t),children:[n("div",{className:P({hidden:!c}),style:{width:a},children:s}),n("div",{ref:f,className:P("border-x cursor-col-resize flex-none flex flex-col space-y-2 px-1 justify-center group hover:bg-gray-200",c?v?"bg-gray-200":"bg-gray-100":"invisible"),onMouseDown:S,children:ce(3).map(y=>n("span",{className:P("rounded-full h-1 w-1 group-hover:bg-slate-400",v?"bg-slate-400":"bg-slate-300")},y))}),n("div",{ref:u,className:P("flex-1",{hidden:!c}),children:r})]}),v&&n("div",{className:"cursor-col-resize inset-0 z-10 fixed"})]})};class yi extends R.exports.Component{componentDidCatch(t){this.props.onError(Oe(t))}render(){return this.props.children}}const Ni=({children:e})=>{const t=T();return n(yi,{onError:r=>{t.dispatch(Rt(Oe(r)))},children:e})},wt=R.exports.createContext({view:void 0,ref:ps}),Ii=e=>{const[t,s]=R.exports.useState(null),r=R.exports.useCallback(c=>{s(c)},[]),[a,o]=R.exports.useState();return R.exports.useEffect(()=>{if(t===null)return;const c=xn.create(e),h=new $({state:c,parent:t});return o(h),()=>{h.destroy(),o(void 0)}},[t,e]),{view:a,ref:r}},pe=()=>{const{view:e}=R.exports.useContext(wt);return e},Ci=()=>{const{ref:e}=R.exports.useContext(wt);return e},yt=e=>({effects:Te.appendConfig.of($.updateListener.of(e))}),nt=Te.define({map({add:e,filter:t},s){return{add:e===void 0?void 0:{from:s.mapPos(e.from),to:s.mapPos(e.to)},filter:t}}}),Li=be.mark({class:"cm-wavyUnderline"}),Di=at.define({create(){return be.none},update(e,t){return t.effects.reduce((s,r)=>{if(!r.is(nt))return s;const{add:a,filter:o}=r.value;return s.update({add:a===void 0?void 0:[Li.range(a.from,a.to)],filter:o})},e.map(t.changes))},provide:e=>$.decorations.from(e)}),Ai=`url('data:image/svg+xml;base64,${window.btoa(`<svg height="4" width="6" xmlns="http://www.w3.org/2000/svg">
  <path fill="none" stroke="red" d="m0 3 l2 -2 l1 0 l2 2 l1 0" />
</svg>`)}')`,ki=()=>[Di,$.baseTheme({".cm-wavyUnderline":{background:`${Ai} left bottom repeat-x`,paddingBottom:"2px"}})],an=wn.define({combine(e){return yn(e,{clearOnPointerSelect:!0},{clearOnPointerSelect(t,s){return s}})}}),rt=Te.define({map({addByPos:e,filter:t},s){return{addByPos:e===void 0?void 0:s.mapPos(e),filter:t}}}),Mi=be.line({attributes:{class:"cm-highlightLine"}}),Ti=at.define({create(){return be.none},update(e,t){const{clearOnPointerSelect:s}=t.state.facet(an);return s&&t.isUserEvent("select.pointer")?be.none:t.effects.reduce((r,a)=>{if(!a.is(rt))return r;const{addByPos:o,filter:c}=a.value;return r.update({add:o===void 0?void 0:[Mi.range(o)],filter:c})},e.map(t.changes))},provide:e=>$.decorations.from(e)}),Oi=(e={})=>[an.of(e),Ti,$.baseTheme({".cm-highlightLine":{backgroundColor:"#dcfce7 !important"}})],Ue=Te.define({map(e,t){return{pos:t.mapPos(e.pos),on:e.on}}});class Gi extends Nn{toDOM(){return document.createTextNode("\u25CF")}}const on=new Gi,cn=at.define({create(){return In.empty},update(e,t){return t.effects.reduce((s,r)=>r.is(Ue)?s.update(r.value.on?{add:[on.range(r.value.pos)]}:{filter:a=>a!==r.value.pos}):s,e.map(t.changes))}}),Me=e=>e.field(cn),Bi=(e,t)=>{const s=Me(e.state);let r=!1;s.between(t,t,()=>{r=!0}),e.dispatch({effects:Ue.of({pos:t,on:!r})})},ln=(e,t,s)=>s.offsetY>t.bottom?!1:(Bi(e,t.from),!0),Pi=()=>[cn,Cn({class:"cm-breakpoints",markers:e=>Me(e.state),initialSpacer:()=>on,domEventHandlers:{mousedown:ln}}),$.baseTheme({".cm-breakpoints .cm-gutterElement":{width:"20px",padding:"0 3px 0 5px",color:"red",cursor:"pointer"}})],Ui=(e,t)=>{if(t.size!==e.size)return!1;if(t.size===0)return!0;const s=t.iter(),r=e.iter();for(let a=0;a<t.size;a++,s.next(),r.next())if(s.from!==r.from||s.to!==r.to)return!1;return!0},Nt=Ln.define(),Fi=e=>t=>t.annotation(Nt)===e,Hi=(e,t)=>{const s=new Array(e.size),r=e.iter();for(let a=0;a<e.size;a++,r.next())s[a]=t(r.from,r.to,r.value);return s},dn=Fi("ChangedFromState"),Vi=e=>{let t;return s=>{if(!s.docChanged)return;const r=s.transactions[0],a=rs(s.state.doc);t!==void 0&&window.clearTimeout(t),t=window.setTimeout(()=>{dn(r)||e.dispatch(Y({value:a})),t=void 0},ht)}},Wi=()=>{const e=pe(),t=T();R.exports.useEffect(()=>{if(e!==void 0)return e.dispatch(yt(Vi(t))),F(Y,({value:s,isFromFile:r})=>{r&&e.dispatch({changes:{from:0,to:e.state.doc.length,insert:s},annotations:Nt.of("ChangedFromState")})})},[e])},Ji=()=>{const e=pe();R.exports.useEffect(()=>{if(e!==void 0)return F(Y,({value:t,isFromFile:s})=>{if(s&&t===Je.content){e.focus();const{title:r,content:a}=Je,o=a.indexOf(r);e.dispatch({selection:{anchor:o,head:o+r.length}})}})},[e])},zi=()=>{const e=pe(),t=T(),s=Xs(()=>rn(t));R.exports.useEffect(()=>{e!==void 0&&Ke(t.getState())&&s(rs(e.state.doc))},[e]),R.exports.useEffect(()=>F(Y,({value:r,isFromFile:a},o)=>{Ke(o.getState())&&(a?window.setTimeout(()=>{s(r)},ht):s(r))}),[])},$i=()=>{const e=pe(),t=T();R.exports.useEffect(()=>{e==null||e.dispatch(yt(r=>{bs(t.getState())!==null&&r.docChanged&&(r.view.dispatch({effects:nt.of({filter:()=>!1})}),t.dispatch(Tr()))}))},[e]);const s=I(kr);R.exports.useEffect(()=>{e==null||e.dispatch({effects:nt.of({add:s,filter:()=>s!==void 0})})},[e,s])},ji=()=>{const e=pe();R.exports.useEffect(()=>F(Y,({isFromFile:s},r)=>{s&&r.dispatch(ve())}),[]);const t=I(Nr(e));R.exports.useEffect(()=>{e==null||e.dispatch(A({effects:t===void 0?rt.of({filter:()=>!1}):t.map((s,r)=>rt.of({addByPos:s,filter:()=>r!==0}))},e.hasFocus||t===void 0?void 0:{selection:{anchor:t[0]},scrollIntoView:!0}))},[e,t])},Ki=e=>t=>{if(t.docChanged){const s=Me(t.state);if(!Ui(Me(t.startState),s)){const r=Hi(s,a=>We(t.state.doc,a));e.dispatch(gs(r))}}else{const s=t.transactions[0];if(s===void 0||dn(s))return;s.effects.forEach(r=>{if(r.is(Ue)){const a=r.value.on?Cr:Lr,o=We(t.state.doc,r.value.pos);e.dispatch(a(o))}})}},Xi=()=>{const e=pe(),t=T();R.exports.useEffect(()=>{if(e===void 0)return;e.dispatch(yt(Ki(t)));const s=dt(t.getState()),r=s.filter(a=>a.to<=e.state.doc.length&&as(a,We(e.state.doc,a.from)));r.length<s.length&&t.dispatch(gs(r)),e.dispatch({effects:r.map(a=>Ue.of({pos:a.from,on:!0})),annotations:Nt.of("ChangedFromState")})},[e])},Zi=2e3,es={type:ie.Info,content:"Info: Program has halted."},Yi=e=>({type:ie.Error,content:`${e.name}: ${e.message}`}),qi=()=>{const e=I(bs),t=I(Na),s=e!=null?e:t,r=I(kt),a=R.exports.useRef();return R.exports.useEffect(()=>F(ze,(o,c)=>{a.current!==void 0&&window.clearTimeout(a.current),a.current=window.setTimeout(()=>{c.dispatch(Mt()),a.current=void 0},Zi)}),[]),R.exports.useEffect(()=>F(tt,(o,c)=>{c.dispatch(ze(es))}),[]),R.exports.useEffect(()=>F(mt,(o,c)=>{kt(c.getState())===es&&(window.clearTimeout(a.current),a.current=void 0,c.dispatch(Mt()))}),[]),s!==null?Yi(s):r},Qi=({className:e})=>{const t=Ci();return Wi(),Ji(),zi(),$i(),ji(),Xi(),n("div",{ref:t,className:P("cursor-auto select-auto overflow-y-auto",e)})},ec=e=>{switch(e){case ie.Error:return"bg-red-500";case ie.Warning:return"bg-yellow-500";case ie.Info:return"bg-blue-500"}},tc=()=>{const e=qi();return e===null?null:n("div",{className:P("py-1 px-2 text-light-100",ec(e.type)),children:e.content})},sc=()=>$.theme({"&":{height:"100%"},"&.cm-focused":{outline:"0"},".cm-scroller":{fontFamily:"'Jetbrains Mono', monospace"},".cm-gutters":{borderRight:"1px solid #e5e7eb",backgroundColor:"#f3f4f6",color:"#9ca3af"},".cm-breakpoints":{fontSize:"0.875em"},".cm-lineNumbers":{paddingRight:"6px"},".cm-cursor":{borderLeft:"2px solid black"}}),nc=/[,[\]:]/,rc=/^[a-zA-Z_]+(?=:)/,ac=/^[a-zA-Z_]+/,oc=/^[^\s;:,["]+/,ic=/^[\da-fA-F]+\b/,cc=/^[a-dA-D][lL]\b/,lc=/\S/,dc=Dn.define({token(e,t){var s;if(t.ended)return e.skipToEnd(),"comment";if(e.eatSpace()||e.eat(nc))return null;if(e.eat(";"))return e.skipToEnd(),"comment";if(e.match(rc))return t.operandsLeft=0,"labelName";if(t.operandsLeft===0){const r=(s=e.match(oc))==null?void 0:s[0];if(r){const a=r.toUpperCase();if(a in x){const o=a;return o===x.END&&(t.ended=!0),t.operandsLeft=xs[o],t.expectLabel=o.startsWith("J"),"keyword"}else return null}}else{if(e.match(ic))return t.operandsLeft-=1,"number";if(e.match(cc))return t.operandsLeft-=1,"variableName.special";if(e.eat('"')){e.skipToEnd();const r=e.current();let a=0;for(let c=1;c<r.length;c++)if(r[c]==='"'&&r[c-1]!=="\\"){a=c;break}const o=r.length-1;return a!==0&&a!==o&&e.backUp(o-a),t.operandsLeft-=1,"string"}if(t.expectLabel&&e.match(ac))return t.operandsLeft-=1,t.expectLabel=!1,"labelName";t.operandsLeft=0}return e.eatWhile(lc),null},startState(){return{ended:!1,operandsLeft:0,expectLabel:!1}}}),uc=/^ */,hc=/^\s*/,pc=()=>[new An(dc),kn(Mn),Tn.of("	"),On.of(({state:e},t)=>{var c,h;const s=e.doc.lineAt(t).text.replace(uc,""),r=(h=(c=hc.exec(s))==null?void 0:c[0].split(""))!=null?h:[],a=r.reduce((f,u)=>u==="	"?f+1:f,0),o=r.length-a;return a*e.tabSize+o})],gc=()=>[Gn(),$.baseTheme({"&.cm-focused .cm-activeLine":{boxShadow:"inset 0 0 0 2px #e5e7eb"},".cm-activeLine":{backgroundColor:"inherit"}})],fc=()=>[Bn({domEventHandlers:{mousedown:ln}}),$.baseTheme({".cm-lineNumbers .cm-gutterElement":{cursor:"pointer"}})],mc={key:"Tab",run:Pn,shift:Un},Rc=[Fn(),Hn(),Vn(),sc(),pc(),gc(),Pi(),fc(),ki(),Oi(),Wn.of([...Jn,...zn,...$n,mc])],bc=()=>{const e=T(),t=R.exports.useMemo(()=>({doc:_e(e.getState()),extensions:Rc}),[]),s=Ii(t);return d("div",{className:"flex flex-col h-full",children:[n(wt.Provider,{value:s,children:n(Qi,{className:"flex-1"})}),n(tc,{})]})},Fe=({title:e,onClick:t,children:s})=>d("header",{className:P("border-b flex space-x-2 bg-gray-100 py-1 px-2 items-center justify-between",{"cursor-pointer":t!==void 0}),onClick:t,children:[n("span",{children:e}),s]});var De=(e=>(e.Hex="hex",e.Bin="bin",e.Dec="dec",e))(De||{});const vc=({label:e,value:t,valueClassName:s})=>n("td",{className:"px-2",children:d("div",{className:"flex space-x-1 items-center justify-center",children:[n("span",{className:"rounded bg-gray-100 text-xs px-1 text-gray-400",children:e}),n("span",{className:P("rounded text-sm px-1",s),children:t})]})}),Ec=()=>n("td",{className:"px-2",children:d("div",{className:"flex space-x-1 items-center justify-center",children:[n("span",{className:"text-xs px-1",children:ue.repeat(3)}),n("span",{className:"text-sm px-1",children:`${ue.repeat(3)}ISOZ${ue}`})]})});var Ae=Object.assign(vc,{FlagIndicator:Ec});const Sc=R.exports.memo(({name:e,value:t,valueClassName:s})=>{const r=te(t),a=us(t),o=ee(t),c=`${o>=0?"+":"-"}${`${Math.abs(o)}`.padStart(3,"0")}`;return d("tr",{className:"divide-x",children:[n("td",{className:"bg-gray-50 text-center px-2",children:e}),n(Ae,{label:De.Hex,value:r,valueClassName:s}),n(Ae,{label:De.Bin,value:a}),n(Ae,{label:De.Dec,value:c})]})}),_c=R.exports.memo(()=>d("tr",{children:[n("td",{children:ue}),n("td",{}),n(Ae.FlagIndicator,{}),n("td",{})]}));var fe=Object.assign(Sc,{FlagIndicator:_c});const xc=()=>{const e=I(Ca,Er),{ip:t,sp:s}=I(Gs),r=I(ka);return d("div",{className:"border-b",children:[n(Fe,{title:"General Purpose Registers"}),d("div",{className:"divide-x flex",children:[n("table",{className:"flex-1",children:n("tbody",{className:"divide-y",children:e.map((a,o)=>{const c=se[o];return n(fe,{name:c,value:a},o)})})}),n("table",{className:"flex-1",children:d("tbody",{className:"divide-y",children:[n(fe,{name:Ce.IP,value:t,valueClassName:"bg-green-100"}),n(fe,{name:Ce.SP,value:s,valueClassName:"bg-blue-100"}),n(fe,{name:Ce.SR,value:r}),n(fe.FlagIndicator,{})]})})]})]})},wc=()=>{const[e,t]=bt(!0),s=e?tn:sn,r=I(Ls),a=I(Zr),o=I(Yr),c=r===ke.Source?o():a(),{ip:h,sp:f}=I(Gs);return d("div",{className:P({"border-b":e}),children:[n(Fe,{title:"Memory",onClick:t,children:n("span",{className:"w-4",children:n(s,{className:"mx-auto fill-gray-400 w-2.5"})})}),e&&n("table",{className:"text-sm w-full",children:d("tbody",{className:"divide-y",children:[d("tr",{className:"divide-x bg-gray-50 text-gray-400",children:[n("td",{}),ce(16).map(u=>n("td",{className:"text-center",children:n("span",{className:"px-1",children:te(u)[1]})},u))]}),c.map((u,E)=>d("tr",{className:"divide-x",children:[n("td",{className:"bg-gray-50 text-center text-gray-400",children:n("span",{className:"px-1",children:te(E)[1]})}),u.map((L,N)=>{const C=E*16+N;return n("td",{className:P("text-center",{"bg-blue-50":f<C&&C<=gt}),children:n("span",{className:P("px-1",{"rounded bg-green-100":C===h,"rounded bg-blue-100":C===f}),children:r===ke.Hexadecimal?te(L):L})},N)})]},E))]})})]})},yc=()=>{const e=T(),t=I(he),s=I(Ua),r=R.exports.useRef(null),a=()=>{window.setTimeout(()=>{var f;(f=r.current)==null||f.focus()})},o=f=>{e.dispatch(Wa({content:f,port:ft.SimulatedKeyboard})),e.dispatch(Ie(!1)),e.dispatch(Us(!1))};return d(xt,{className:"bg-black flex bg-opacity-80 inset-0 fixed items-center justify-center",isOpen:t&&s,children:[n("div",{className:"border rounded bg-light-100 py-2 px-4",children:"Waiting for keyboard input"}),n("input",{ref:r,autoFocus:!0,className:"-z-1 absolute",onBlur:a,onChange:({target:f})=>{const u=f.value;o(u.charCodeAt(0))},onKeyDown:f=>{switch(f.key){case"Backspace":o(me.BS);break;case"Tab":f.preventDefault(),o(me.TAB);break;case"Enter":o(me.CR);break;case"Escape":o(ks);break}}})]})},It=({name:e,onClickClose:t,children:s,className:r})=>d("div",{className:"border shadow m-1",children:[n(Fe,{title:e,children:n("span",{className:"rounded-full flex bg-gray-200 h-4 w-4 justify-center group",onClick:t,children:n(vo,{className:"fill-none w-2 group-hover:fill-gray-400"})})}),n("div",{className:P("p-1",r),children:s})]}),Ct=e=>{const t=T(),s=I(Ha(e)),r=I(Va(e)),a=R.exports.useCallback(()=>{t.dispatch(Vs(e))},[]);return R.exports.useEffect(()=>{if(!r)return F(Hs,({name:o})=>{o===e&&a()})},[r]),{data:s,isVisible:r,toggleVisible:a}},Nc=()=>{const e=Ct(le.VisualDisplayUnit);return R.exports.useEffect(()=>F(Ds,(t,s)=>{const r=pt(s.getState());s.dispatch(Fs(r))}),[]),e},Ic=()=>{const{data:e,isVisible:t,toggleVisible:s}=Nc();return t?n(It,{className:"flex flex-col space-y-1",name:"Visual Display Unit",onClickClose:s,children:it(16,Sr(e)).map((r,a)=>n("div",{className:"flex space-x-1",children:r.map((o,c)=>n("div",{className:"bg-gray-200 text-center w-4.5",children:o===" "?ue:o},c))},a))}):null},Cc=R.exports.memo(()=>d(G,{children:[n("rect",{fill:"#a1a1aa",height:"120",width:"320",x:"0",y:"120",children:n("title",{children:"Background"})}),d("g",{fill:"#000",children:[n("title",{children:"Pillar"}),n("rect",{height:"112",width:"48",x:"32",y:"24"}),n("rect",{height:"80",width:"16",x:"48",y:"136"}),n("rect",{height:"12",width:"32",x:"40",y:"216"}),n("rect",{height:"112",width:"48",x:"232",y:"24"}),n("rect",{height:"80",width:"16",x:"248",y:"136"}),n("rect",{height:"12",width:"32",x:"240",y:"216"})]}),d("g",{fill:"none",stroke:"#fff",strokeWidth:"2",children:[n("title",{children:"Circut"}),n("polyline",{points:"44,44 36,44 36,132 52,132 52,180 100,180 100,200"}),n("polyline",{points:"44,76 40,76 40,128 56,128 56,176 116,176 116,200"}),n("polyline",{points:"68,108 72,108 72,132 60,132 60,172 132,172 132,200"}),n("polyline",{points:"244,44 236,44 236,132 252,132 252,172 148,172 148,200"}),n("polyline",{points:"244,76 240,76 240,128 256,128 256,176 164,176 164,200"}),n("polyline",{points:"268,108 272,108 272,132 260,132 260,180 180,180 180,200"}),n("polyline",{points:"196,200 196,184 276,184 276,160"}),n("polyline",{points:"212,200 212,188 280,188 280,164"})]}),d("g",{fill:"#fff",children:[n("title",{children:"Circut Node"}),ce(8).map(e=>n("rect",{height:"8",width:"8",x:96+e*16,y:"200"},e))]}),d("g",{fill:"#fff",textAnchor:"middle",children:[n("title",{children:"Label"}),n("text",{x:"24",y:"210",children:"MSB"}),n("text",{x:"288",y:"210",children:"LSB"})]})]})),Lc=["red","yellow","lime"],Dc=()=>{const{data:e,isVisible:t,toggleVisible:s}=Ct(le.TrafficLights);return t?n(It,{name:"Traffic Lights",onClickClose:s,children:d("svg",{viewBox:"0 0 312 240",width:"312",xmlns:"http://www.w3.org/2000/svg",children:[d("g",{children:[n("title",{children:"Static Layer"}),n(Cc,{})]}),d("g",{children:[n("title",{children:"Lights Layer"}),ce(6).map(r=>{const a=Boolean(e[r]);return n("circle",{cx:r<3?56:256,cy:44+r%3*32,fill:a?Lc[r%3]:"none",r:"12"},r)})]}),d("g",{fill:"#fff",textAnchor:"middle",children:[n("title",{children:"Data Layer"}),e.map((r,a)=>n("text",{x:100+a*16,y:"224",children:r},a))]})]})}):null},Ac=R.exports.memo(()=>d(G,{children:[n("rect",{fill:"#a1a1aa",height:"300",width:"320",children:n("title",{children:"Background"})}),d("g",{fill:"#000",children:[n("title",{children:"Screen"}),n("rect",{height:"128",width:"80",x:"40",y:"56"}),n("rect",{height:"128",width:"80",x:"192",y:"56"})]}),d("g",{fill:"none",stroke:"#fff",strokeWidth:"2",children:[n("title",{children:"Circut"}),d("g",{children:[n("title",{children:"Digit 0"}),n("polyline",{points:"100,260 100,248 20,248 20,40 232,40 232,64"}),n("line",{x1:"80",x2:"80",y1:"40",y2:"64"}),n("line",{x1:"56",x2:"104",y1:"64",y2:"64"}),n("line",{x1:"208",x2:"256",y1:"64",y2:"64"})]}),d("g",{children:[n("title",{children:"Digit 1"}),n("polyline",{points:"116,260 116,240 28,240 28,48 188,48 188,92 204,92"}),n("line",{x1:"28",x2:"52",y1:"92",y2:"92"}),n("line",{x1:"52",x2:"52",y1:"68",y2:"116"}),n("line",{x1:"204",x2:"204",y1:"68",y2:"116"})]}),d("g",{children:[n("title",{children:"Digit 2"}),n("polyline",{points:"132,260 132,232 36,232 36,148 52,148"}),n("polyline",{points:"132,232 208,232 208,192 188,192 188,148 204,148"}),n("line",{x1:"52",x2:"52",y1:"124",y2:"172"}),n("line",{x1:"204",x2:"204",y1:"124",y2:"172"})]}),d("g",{children:[n("title",{children:"Digit 3"}),n("polyline",{points:"148,260 148,224 80,224 80,176"}),n("polyline",{points:"148,224 232,224 232,176"}),n("line",{x1:"56",x2:"104",y1:"176",y2:"176"}),n("line",{x1:"208",x2:"256",y1:"176",y2:"176"})]}),d("g",{children:[n("title",{children:"Digit 4"}),n("polyline",{points:"164,260 164,216 124,216 124,148 108,148"}),n("polyline",{points:"164,216 276,216 276,148 260,148"}),n("line",{x1:"108",x2:"108",y1:"124",y2:"172"}),n("line",{x1:"260",x2:"260",y1:"124",y2:"172"})]}),d("g",{children:[n("title",{children:"Digit 5"}),n("polyline",{points:"180,260 180,208 132,208 132,120 56,120"}),n("polyline",{points:"180,208 284,208 284,120 208,120"})]}),d("g",{children:[n("title",{children:"Digit 6"}),n("polyline",{points:"196,260 196,200 140,200 140,92 108,92"}),n("polyline",{points:"196,200 292,200 292,92 260,92"}),n("line",{x1:"108",x2:"108",y1:"68",y2:"116"}),n("line",{x1:"260",x2:"260",y1:"68",y2:"116"})]}),d("g",{children:[n("title",{children:"Digit 7"}),n("polyline",{points:"212,260 212,240 300,240 300,24 204,24"}),d("g",{fill:"#a1a1aa",children:[n("title",{children:"Inverter"}),n("polygon",{points:"204,24 204,14 194,24 204,34 204,24"}),n("circle",{cx:"190",cy:"24",r:"2"})]}),n("polyline",{points:"188,24 118,24 118,56"}),n("line",{x1:"270",x2:"270",y1:"24",y2:"56"})]})]}),d("g",{fill:"#fff",children:[n("title",{children:"Circut Node"}),ce(8).map(e=>n("rect",{height:"8",width:"8",x:96+e*16,y:"260"},e)),ce(5).map(e=>n("rect",{height:"4",width:"8",x:128+e*16,y:230-e*8},e)),n("rect",{height:"4",width:"8",x:"76",y:"38"}),n("rect",{height:"4",width:"8",x:"24",y:"90"}),n("rect",{height:"4",width:"8",x:"266",y:"22"}),n("rect",{height:"8",width:"8",x:"266",y:"54"}),n("rect",{height:"8",width:"8",x:"114",y:"54"})]}),d("g",{fill:"#fff",textAnchor:"middle",children:[n("title",{children:"Label"}),n("text",{x:"60",y:"270",children:"MSB"}),n("text",{x:"252",y:"270",children:"LSB"})]})]})),kc=[n("polygon",{points:"56,64 104,64 96,72 64,72"},0),n("polygon",{points:"208,64 256,64 248,72 216,72"},1),n("polygon",{points:"52,68 60,76 60,108 52,116"},2),n("polygon",{points:"204,68 212,76 212,108 204,116"},3),n("polygon",{points:"52,124 60,132 60,164 52,172"},4),n("polygon",{points:"204,124 212,132 212,164 204,172"},5),n("polygon",{points:"56,176 64,168 96,168 104,176"},6),n("polygon",{points:"208,176 216,168 248,168 256,176"},7),n("polygon",{points:"108,124 108,172 100,164 100,132"},8),n("polygon",{points:"260,124 260,172 252,164 252,132"},9),n("polygon",{points:"56,120 60,116 100,116 104,120 100,124 60,124"},10),n("polygon",{points:"208,120 212,116 252,116 256,120 252,124 212,124"},11),n("polygon",{points:"108,68 108,116 100,108 100,76"},12),n("polygon",{points:"260,68 260,116 252,108 252,76"},13)],ts=new Array(14).fill(0),Mc=()=>{const[e,t]=R.exports.useState(ts);R.exports.useEffect(()=>F(Ws,()=>{t(ts)}),[]);const{data:s,isVisible:r,toggleVisible:a}=Ct(le.SevenSegmentDisplay);return R.exports.useEffect(()=>{const o=ns(e,c=>{for(let h=s[7];h<14;h+=2)c[h]=s[Math.floor(h/2)]});t(o)},[s]),r?n(It,{name:"Seven-Segment Display",onClickClose:a,children:d("svg",{viewBox:"0 0 320 300",width:"320",xmlns:"http://www.w3.org/2000/svg",children:[d("g",{children:[n("title",{children:"Static Layer"}),n(Ac,{})]}),d("g",{fill:"lime",stroke:"lime",strokeWidth:"2",children:[n("title",{children:"Segments Layer"}),kc.filter((o,c)=>e[c]===1)]}),d("g",{fill:"#fff",textAnchor:"middle",children:[n("title",{children:"Data Layer"}),s.map((o,c)=>n("text",{x:100+c*16,y:"284",children:o},c))]})]})}):null},Tc=()=>{const[e,t]=bt(!0);return d("div",{children:[n(Fe,{title:"I/O Devices",onClick:t,children:n("span",{className:"w-4",children:n(e?tn:sn,{className:"mx-auto fill-gray-400 w-2.5"})})}),n(yc,{}),e&&d("div",{className:"flex flex-wrap py-1 px-1 items-start",children:[n(Ic,{}),n(Dc,{}),n(Mc,{})]})]})},Oc=()=>{var o;const e=T(),t=I(ja),s=t!==null,r=R.exports.useCallback(()=>{e.dispatch(Ka())},[]),a=vt(r);return n(xt,{className:"bg-white flex bg-opacity-80 inset-0 z-50 fixed items-center justify-center",isOpen:s,children:d("div",{ref:a,className:"border rounded space-y-2 bg-light-100 shadow py-2 px-4 select-text all:select-text",children:[s?(o=t.stack)==null?void 0:o.split(/\n(.*)/s).slice(0,-1).map((c,h)=>h===0?n("div",{children:c.split(": ").map((u,E)=>n("div",{className:E===0?"text-xl text-red-500":"border-b text-lg py-1",children:u},E))},h):n("div",{className:"rounded bg-red-50 py-2 px-5.5 text-gray-600 whitespace-pre-line",children:c},h)):null,d("div",{children:["Please report this bug at"," ",n(Re,{href:"https://github.com/exuanbo/assembler-simulator/issues",children:"https://github.com/exuanbo/assembler-simulator/issues"}),"."]})]})})};function Gc(e={}){const{immediate:t=!1,onNeedRefresh:s,onOfflineReady:r,onRegistered:a,onRegisterError:o}=e;let c,h;const f=async(u=!0)=>{u&&(c==null||c.addEventListener("controlling",E=>{E.isUpdate&&window.location.reload()})),h&&h.waiting&&await Kn(h.waiting,{type:"SKIP_WAITING"})};if("serviceWorker"in navigator){c=new jn("./sw.js",{scope:"./",type:"classic"}),c.addEventListener("activated",u=>{u.isUpdate||r==null||r()});{const u=()=>{s==null||s()};c.addEventListener("waiting",u),c.addEventListener("externalwaiting",u)}c.register({immediate:t}).then(u=>{h=u,a==null||a(u)}).catch(u=>{o==null||o(u)})}return f}function Bc(e={}){const{immediate:t=!0,onNeedRefresh:s,onOfflineReady:r,onRegistered:a,onRegisterError:o}=e,[c,h]=R.exports.useState(!1),[f,u]=R.exports.useState(!1),[E]=R.exports.useState(()=>Gc({immediate:t,onOfflineReady(){u(!0),r==null||r()},onNeedRefresh(){h(!0),s==null||s()},onRegistered:a,onRegisterError:o}));return{needRefresh:[c,h],offlineReady:[f,u],updateServiceWorker:E}}const ss=({onClick:e,children:t})=>n("div",{className:"border rounded bg-gray-100 py-1 px-2 inline-block hover:bg-gray-200",onClick:e,children:t}),Pc=()=>{const{needRefresh:[e,t],updateServiceWorker:s}=Bc(),[r,a]=R.exports.useState(!1);return r?n("div",{className:"bg-white flex bg-opacity-80 inset-0 z-10 fixed justify-center items-center",children:n(Eo,{className:"animate-spin w-6"})}):e?d("div",{className:"border rounded space-y-2 bg-light-100 shadow py-2 px-4 right-4 bottom-4 fixed",children:[n("div",{children:"New version is available"}),d("div",{className:"space-x-2",children:[n(ss,{onClick:async()=>{a(!0),await s(!0)},children:"Reload"}),n(ss,{onClick:()=>{t(!1)},children:"Close"})]})]}):null},Uc=Z(Ir,Hr,(e,t)=>({editor:e,controller:t})),Fc=()=>(R.exports.useEffect(()=>js(Uc,e=>{to(e)}),[]),d(G,{children:[d("div",{className:"flex flex-col",children:[n(_i,{}),d(wi,{className:"h-[calc(100vh-2rem)] w-full top-8 fixed",children:[n(Ni,{children:n(bc,{})}),d("div",{className:"flex flex-col h-full overflow-y-auto",children:[n(xc,{}),n(wc,{}),n(Tc,{})]})]})]}),n(Pc,{}),n(Oc,{})]})),Hc=document.getElementById("app-root"),Vc=Xn.createRoot(Hc);Vc.render(n(Zn.StrictMode,{children:n(Yn,{store:no,children:n(Fc,{})})}));
